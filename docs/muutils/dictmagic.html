<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.7.0"/>
    <title>muutils.dictmagic API documentation</title>
<link rel="stylesheet" href="../resources/css/bootstrap-reboot.min.css"><link rel="stylesheet" href="../resources/css/syntax-highlighting.css"><link rel="stylesheet" href="../resources/css/theme.css"><link rel="stylesheet" href="../resources/css/layout.css"><link rel="stylesheet" href="../resources/css/content.css"><link rel="stylesheet" href="../resources/css/custom.css"><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
<div class="package-version">
    docs for <a href="https://github.com/mivanit/muutils">muutils</a> v0.8.1<br>
</div>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button">
            <img src="../resources/svg/navtoggle.svg" alt="Toggle navigation"> 
        </label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../muutils.html">
                <img src="../resources/svg/box-arrow-in-left.svg" alt="Back to parent module"/>
                &nbsp;muutils</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DefaulterDict">DefaulterDict</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#DefaulterDict.default_factory">default_factory</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#defaultdict_to_dict_recursive">defaultdict_to_dict_recursive</a>
            </li>
            <li>
                    <a class="function" href="#dotlist_to_nested_dict">dotlist_to_nested_dict</a>
            </li>
            <li>
                    <a class="function" href="#nested_dict_to_dotlist">nested_dict_to_dotlist</a>
            </li>
            <li>
                    <a class="function" href="#update_with_nested_dict">update_with_nested_dict</a>
            </li>
            <li>
                    <a class="function" href="#kwargs_to_nested_dict">kwargs_to_nested_dict</a>
            </li>
            <li>
                    <a class="function" href="#is_numeric_consecutive">is_numeric_consecutive</a>
            </li>
            <li>
                    <a class="function" href="#condense_nested_dicts_numeric_keys">condense_nested_dicts_numeric_keys</a>
            </li>
            <li>
                    <a class="function" href="#condense_nested_dicts_matching_values">condense_nested_dicts_matching_values</a>
            </li>
            <li>
                    <a class="function" href="#condense_nested_dicts">condense_nested_dicts</a>
            </li>
            <li>
                    <a class="function" href="#tuple_dims_replace">tuple_dims_replace</a>
            </li>
            <li>
                    <a class="variable" href="#TensorDict">TensorDict</a>
            </li>
            <li>
                    <a class="variable" href="#TensorIterable">TensorIterable</a>
            </li>
            <li>
                    <a class="variable" href="#TensorDictFormats">TensorDictFormats</a>
            </li>
            <li>
                    <a class="function" href="#condense_tensor_dict">condense_tensor_dict</a>
            </li>
    </ul>


    <hr/>
    
    <div>
        <a href="../coverage/html/index.html" class="pdoc-button" title="View test coverage report">
            Coverage
        </a>
        <a href="../other/todo-inline.html" class="pdoc-button" title="Table of TODOs scraped from source code, with links to create issues from them">
            TODOs
        </a>
        <a href="../other/lmcat.txt" class="pdoc-button" title="a view of the repo contents made for LLMs, using https://miv.name/lmcat">
            lmcat
        </a>
    </div>


        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span>
            <img src="../resources/svg/pdoc-logo.svg" alt="pdoc logo"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py">View Source on GitHub</a>
                    <h1 class="modulename">
<a href="./../muutils.html">muutils</a><wbr>.dictmagic    </h1>

                        <div class="docstring"><p>making working with dictionaries easier</p>

<ul>
<li><code><a href="#DefaulterDict">DefaulterDict</a></code>: like a defaultdict, but default_factory is passed the key as an argument</li>
<li>various methods for working wit dotlist-nested dicts, converting to and from them</li>
<li><code><a href="#condense_nested_dicts">condense_nested_dicts</a></code>: condense a nested dict, by condensing numeric or matching keys with matching values to ranges</li>
<li><code><a href="#condense_tensor_dict">condense_tensor_dict</a></code>: convert a dictionary of tensors to a dictionary of shapes</li>
<li><code><a href="#kwargs_to_nested_dict">kwargs_to_nested_dict</a></code>: given kwargs from fire, convert them to a nested dict</li>
</ul>
</div>

                        <input id="mod-dictmagic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="mod-dictmagic-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L0-L521" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

                <br/>
                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;making working with dictionaries easier</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">- `DefaulterDict`: like a defaultdict, but default_factory is passed the key as an argument</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">- various methods for working wit dotlist-nested dicts, converting to and from them</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">- `condense_nested_dicts`: condense a nested dict, by condensing numeric or matching keys with matching values to ranges</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">- `condense_tensor_dict`: convert a dictionary of tensors to a dictionary of shapes</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">- `kwargs_to_nested_dict`: given kwargs from fire, convert them to a nested dict</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">typing</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">Any</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="n">Callable</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="n">Generic</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="n">Hashable</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="n">Iterable</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    <span class="n">Literal</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="n">Optional</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>    <span class="n">TypeVar</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    <span class="n">Union</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span> <span class="nn">muutils.errormode</span> <span class="kn">import</span> <span class="n">ErrorMode</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="n">_KT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_KT&quot;</span><span class="p">)</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="n">_VT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_VT&quot;</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="k">class</span> <span class="nc">DefaulterDict</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">],</span> <span class="n">Generic</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]):</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;like a defaultdict, but default_factory is passed the key as an argument&quot;&quot;&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">_KT</span><span class="p">],</span> <span class="n">_VT</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>                <span class="sa">f</span><span class="s2">&quot;DefaulterDict does not support positional arguments: *args = </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>            <span class="p">)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">_KT</span><span class="p">],</span> <span class="n">_VT</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_factory</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">_KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_VT</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>            <span class="n">v</span><span class="p">:</span> <span class="n">_VT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>            <span class="k">return</span> <span class="n">v</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="k">def</span> <span class="nf">_recursive_defaultdict_ctor</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">defaultdict</span><span class="p">:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="k">return</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">_recursive_defaultdict_ctor</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="k">def</span> <span class="nf">defaultdict_to_dict_recursive</span><span class="p">(</span><span class="n">dd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">defaultdict</span><span class="p">,</span> <span class="n">DefaulterDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a defaultdict or DefaulterDict to a normal dict, recursively&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">key</span><span class="p">:</span> <span class="p">(</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>            <span class="n">defaultdict_to_dict_recursive</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">defaultdict</span><span class="p">,</span> <span class="n">DefaulterDict</span><span class="p">))</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="k">else</span> <span class="n">value</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="p">}</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="k">def</span> <span class="nf">dotlist_to_nested_dict</span><span class="p">(</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">dot_dict</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a dict with dot-separated keys to a nested dict</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    Example:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        &gt;&gt;&gt; dotlist_to_nested_dict({&#39;a.b.c&#39;: 1, &#39;a.b.d&#39;: 2, &#39;a.e&#39;: 3})</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        {&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: 1, &#39;d&#39;: 2}, &#39;e&#39;: 3}}</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="n">nested_dict</span><span class="p">:</span> <span class="n">defaultdict</span> <span class="o">=</span> <span class="n">_recursive_defaultdict_ctor</span><span class="p">()</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dot_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key must be a string, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">current</span><span class="p">:</span> <span class="n">defaultdict</span> <span class="o">=</span> <span class="n">nested_dict</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="c1"># iterate over the keys except the last one</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">for</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="n">sub_key</span><span class="p">]</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">current</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="k">return</span> <span class="n">defaultdict_to_dict_recursive</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="k">def</span> <span class="nf">nested_dict_to_dotlist</span><span class="p">(</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="n">nested_dict</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="n">allow_lists</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="nf">_recurse</span><span class="p">(</span><span class="n">current</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="n">items</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="n">new_key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="c1"># dict case</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="ow">and</span> <span class="n">parent_key</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="n">items</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                    <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}{</span><span class="n">sep</span><span class="si">}{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">parent_key</span> <span class="k">else</span> <span class="n">k</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                    <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_recurse</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">new_key</span><span class="p">))</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">elif</span> <span class="n">allow_lists</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="c1"># list case</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current</span><span class="p">):</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>                <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}{</span><span class="n">sep</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">parent_key</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_recurse</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">new_key</span><span class="p">))</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="c1"># anything else (write value)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="n">items</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">items</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">return</span> <span class="n">_recurse</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="k">def</span> <span class="nf">update_with_nested_dict</span><span class="p">(</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="n">original</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="n">update</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a dict with a nested dict</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">    Example:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    &gt;&gt;&gt; update_with_nested_dict({&#39;a&#39;: {&#39;b&#39;: 1}, &quot;c&quot;: -1}, {&#39;a&#39;: {&quot;b&quot;: 2}})</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    {&#39;a&#39;: {&#39;b&#39;: 2}, &#39;c&#39;: -1}</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    # Arguments</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">    - `original: dict[str, Any]`</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        the dict to update (will be modified in-place)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">    - `update: dict[str, Any]`</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        the dict to update with</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    # Returns</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">    - `dict`</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        the updated dict</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">original</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                <span class="n">update_with_nested_dict</span><span class="p">(</span><span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                <span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">return</span> <span class="n">original</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="k">def</span> <span class="nf">kwargs_to_nested_dict</span><span class="p">(</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="n">kwargs_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">strip_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="n">when_unknown_prefix</span><span class="p">:</span> <span class="n">ErrorMode</span> <span class="o">=</span> <span class="n">ErrorMode</span><span class="o">.</span><span class="n">WARN</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="n">transform_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;given kwargs from fire, convert them to a nested dict</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">    if strip_prefix is not None, then all keys must start with the prefix. by default,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">    will warn if an unknown prefix is found, but can be set to raise an error or ignore it:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">    `when_unknown_prefix: ErrorMode`</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    Example:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">    ```python</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">    def main(**kwargs):</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        print(kwargs_to_nested_dict(kwargs))</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">    fire.Fire(main)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">    ```</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">    running the above script will give:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">    ```bash</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    $ python test.py --a.b.c=1 --a.b.d=2 --a.e=3</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">    {&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: 1, &#39;d&#39;: 2}, &#39;e&#39;: 3}}</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    ```</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">    # Arguments</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">    - `kwargs_dict: dict[str, Any]`</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        the kwargs dict to convert</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">    - `sep: str = &quot;.&quot;`</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        the separator to use for nested keys</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">    - `strip_prefix: Optional[str] = None`</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        if not None, then all keys must start with this prefix</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">    - `when_unknown_prefix: ErrorMode = ErrorMode.WARN`</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        what to do when an unknown prefix is found</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">    - `transform_key: Callable[[str], str] | None = None`</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        a function to apply to each key before adding it to the dict (applied after stripping the prefix)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="n">when_unknown_prefix</span> <span class="o">=</span> <span class="n">ErrorMode</span><span class="o">.</span><span class="n">from_any</span><span class="p">(</span><span class="n">when_unknown_prefix</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>    <span class="n">filtered_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="k">if</span> <span class="n">strip_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">strip_prefix</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                <span class="n">when_unknown_prefix</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                    <span class="sa">f</span><span class="s2">&quot;key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; does not start with &#39;</span><span class="si">{</span><span class="n">strip_prefix</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>                    <span class="n">except_cls</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>                <span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">strip_prefix</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">transform_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">transform_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="n">filtered_kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>    <span class="k">return</span> <span class="n">dotlist_to_nested_dict</span><span class="p">(</span><span class="n">filtered_kwargs</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="k">def</span> <span class="nf">is_numeric_consecutive</span><span class="p">(</span><span class="n">lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the list of keys is numeric and consecutive.&quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="n">numbers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="k">def</span> <span class="nf">condense_nested_dicts_numeric_keys</span><span class="p">(</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;condense a nested dict, by condensing numeric keys with matching values to ranges</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">    # Examples:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">    ```python</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">    &gt;&gt;&gt; condense_nested_dicts_numeric_keys({&#39;1&#39;: 1, &#39;2&#39;: 1, &#39;3&#39;: 1, &#39;4&#39;: 2, &#39;5&#39;: 2, &#39;6&#39;: 2})</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">    {&#39;[1-3]&#39;: 1, &#39;[4-6]&#39;: 2}</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">    &gt;&gt;&gt; condense_nested_dicts_numeric_keys({&#39;1&#39;: {&#39;1&#39;: &#39;a&#39;, &#39;2&#39;: &#39;a&#39;}, &#39;2&#39;: &#39;b&#39;})</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">    {&quot;1&quot;: {&quot;[1-2]&quot;: &quot;a&quot;}, &quot;2&quot;: &quot;b&quot;}</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">    ```</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="c1"># Process each sub-dictionary</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">condense_nested_dicts_numeric_keys</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="c1"># Find all numeric, consecutive keys</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="k">if</span> <span class="n">is_numeric_consecutive</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="c1"># output dict</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="n">condensed_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="c1"># Identify ranges of identical values and condense</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">j</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="k">while</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># Found consecutive keys with identical values</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="n">condensed_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">condensed_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>    <span class="k">return</span> <span class="n">condensed_data</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="k">def</span> <span class="nf">condense_nested_dicts_matching_values</span><span class="p">(</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>    <span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;condense a nested dict, by condensing keys with matching values</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">    # Examples: TODO</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">    # Parameters:</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">     - `data : dict[str, Any]`</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        data to process</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">     - `val_condense_fallback_mapping : Callable[[Any], Hashable] | None`</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        a function to apply to each value before adding it to the dict (if it&#39;s not hashable)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        (defaults to `None`)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">condense_nested_dicts_matching_values</span><span class="p">(</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="n">value</span><span class="p">,</span> <span class="n">val_condense_fallback_mapping</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="p">}</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="c1"># Find all identical values and condense by stitching together keys</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="n">values_grouped</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="n">data_persist</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                <span class="n">values_grouped</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                <span class="c1"># If the value is unhashable, use a fallback mapping to find a hashable representation</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                <span class="k">if</span> <span class="n">val_condense_fallback_mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                    <span class="n">values_grouped</span><span class="p">[</span><span class="n">val_condense_fallback_mapping</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                    <span class="n">data_persist</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="n">data_persist</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>    <span class="n">condensed_data</span> <span class="o">=</span> <span class="n">data_persist</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">values_grouped</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="n">merged_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>  <span class="c1"># Choose an appropriate method to represent merged keys</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">merged_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="k">return</span> <span class="n">condensed_data</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="k">def</span> <span class="nf">condense_nested_dicts</span><span class="p">(</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="n">condense_numeric_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    <span class="n">condense_matching_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;condense a nested dict, by condensing numeric or matching keys with matching values to ranges</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">    combines the functionality of `condense_nested_dicts_numeric_keys()` and `condense_nested_dicts_matching_values()`</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">    # NOTE: this process is not meant to be reversible, and is intended for pretty-printing and visualization purposes</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">    it&#39;s not reversible because types are lost to make the printing pretty</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">    # Parameters:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">     - `data : dict[str, Any]`</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        data to process</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">     - `condense_numeric_keys : bool`</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">        whether to condense numeric keys (e.g. &quot;1&quot;, &quot;2&quot;, &quot;3&quot;) to ranges (e.g. &quot;[1-3]&quot;)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">       (defaults to `True`)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">     - `condense_matching_values : bool`</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        whether to condense keys with matching values</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">       (defaults to `True`)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">     - `val_condense_fallback_mapping : Callable[[Any], Hashable] | None`</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        a function to apply to each value before adding it to the dict (if it&#39;s not hashable)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">       (defaults to `None`)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="n">condensed_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="k">if</span> <span class="n">condense_numeric_keys</span><span class="p">:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="n">condensed_data</span> <span class="o">=</span> <span class="n">condense_nested_dicts_numeric_keys</span><span class="p">(</span><span class="n">condensed_data</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="k">if</span> <span class="n">condense_matching_values</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="n">condensed_data</span> <span class="o">=</span> <span class="n">condense_nested_dicts_matching_values</span><span class="p">(</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="n">condensed_data</span><span class="p">,</span> <span class="n">val_condense_fallback_mapping</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="k">return</span> <span class="n">condensed_data</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="k">def</span> <span class="nf">tuple_dims_replace</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>    <span class="n">t</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dims_names_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="k">if</span> <span class="n">dims_names_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="k">return</span> <span class="n">t</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dims_names_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="n">TensorDict</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;torch.Tensor|np.ndarray&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[name-defined] # noqa: F821</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="n">TensorIterable</span> <span class="o">=</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;torch.Tensor|np.ndarray&quot;</span><span class="p">]]</span>  <span class="c1"># type: ignore[name-defined] # noqa: F821</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="n">TensorDictFormats</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dict&quot;</span><span class="p">,</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">]</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="k">def</span> <span class="nf">_default_shapes_convert</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="k">def</span> <span class="nf">condense_tensor_dict</span><span class="p">(</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">TensorDict</span> <span class="o">|</span> <span class="n">TensorIterable</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="n">fmt</span><span class="p">:</span> <span class="n">TensorDictFormats</span> <span class="o">=</span> <span class="s2">&quot;dict&quot;</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="n">shapes_convert</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">tuple</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">_default_shapes_convert</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="n">drop_batch_dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="n">dims_names_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="n">condense_numeric_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="n">condense_matching_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="n">return_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorDictFormats</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a dictionary of tensors to a dictionary of shapes.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">    by default, values are converted to strings of their shapes (for nice printing).</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">    If you want the actual shapes, set `shapes_convert = lambda x: x` or `shapes_convert = None`.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">    # Parameters:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">     - `data : dict[str, &quot;torch.Tensor|np.ndarray&quot;] | Iterable[tuple[str, &quot;torch.Tensor|np.ndarray&quot;]]`</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        a either a `TensorDict` dict from strings to tensors, or an `TensorIterable` iterable of (key, tensor) pairs (like you might get from a `dict().items())` )</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">     - `fmt : TensorDictFormats`</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        format to return the result in -- either a dict, or dump to json/yaml directly for pretty printing. will crash if yaml is not installed.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        (defaults to `&#39;dict&#39;`)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">     - `shapes_convert : Callable[[tuple], Any]`</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        conversion of a shape tuple to a string or other format (defaults to turning it into a string and removing quotes)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        (defaults to `lambdax:str(x).replace(&#39;&quot;&#39;, &#39;&#39;).replace(&quot;&#39;&quot;, &#39;&#39;)`)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">     - `drop_batch_dims : int`</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        number of leading dimensions to drop from the shape</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        (defaults to `0`)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">     - `sep : str`</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        separator to use for nested keys</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        (defaults to `&#39;.&#39;`)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">     - `dims_names_map : dict[int, str] | None`</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        convert certain dimension values in shape. not perfect, can be buggy</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        (defaults to `None`)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">     - `condense_numeric_keys : bool`</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        whether to condense numeric keys (e.g. &quot;1&quot;, &quot;2&quot;, &quot;3&quot;) to ranges (e.g. &quot;[1-3]&quot;), passed on to `condense_nested_dicts`</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        (defaults to `True`)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">     - `condense_matching_values : bool`</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        whether to condense keys with matching values, passed on to `condense_nested_dicts`</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        (defaults to `True`)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">     - `val_condense_fallback_mapping : Callable[[Any], Hashable] | None`</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        a function to apply to each value before adding it to the dict (if it&#39;s not hashable), passed on to `condense_nested_dicts`</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        (defaults to `None`)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">     - `return_format : TensorDictFormats | None`</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">        legacy alias for `fmt` kwarg</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">    # Returns:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">     - `str|dict[str, str|tuple[int, ...]]`</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        dict if `return_format=&#39;dict&#39;`, a string for `json` or `yaml` output</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    # Examples:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">    ```python</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">    &gt;&gt;&gt; model = transformer_lens.HookedTransformer.from_pretrained(&quot;gpt2&quot;)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">    &gt;&gt;&gt; print(condense_tensor_dict(model.named_parameters(), return_format=&#39;yaml&#39;))</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">    ```</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">    ```yaml</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">    embed:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">      W_E: (50257, 768)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">    pos_embed:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">      W_pos: (1024, 768)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">    blocks:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">      &#39;[0-11]&#39;:</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        attn:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">          &#39;[W_Q, W_K, W_V]&#39;: (12, 768, 64)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">          W_O: (12, 64, 768)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">          &#39;[b_Q, b_K, b_V]&#39;: (12, 64)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">          b_O: (768,)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        mlp:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">          W_in: (768, 3072)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">          b_in: (3072,)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">          W_out: (3072, 768)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">          b_out: (768,)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">    unembed:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">      W_U: (768, 50257)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">      b_U: (50257,)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    ```</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">    # Raises:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">     - `ValueError` :  if `return_format` is not one of &#39;dict&#39;, &#39;json&#39;, or &#39;yaml&#39;, or if you try to use &#39;yaml&#39; output without having PyYAML installed</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>    <span class="c1"># handle arg processing:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="c1"># ----------------------------------------------------------------------</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>    <span class="c1"># make all args except data and format keyword-only</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;unexpected positional args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="c1"># handle legacy return_format</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>    <span class="k">if</span> <span class="n">return_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="s2">&quot;return_format is deprecated, use fmt instead&quot;</span><span class="p">,</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="n">fmt</span> <span class="o">=</span> <span class="n">return_format</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="c1"># identity function for shapes_convert if not provided</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>    <span class="k">if</span> <span class="n">shapes_convert</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">shapes_convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>  <span class="c1"># noqa: E731</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>    <span class="c1"># convert to iterable</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>    <span class="n">data_items</span><span class="p">:</span> <span class="s2">&quot;Iterable[tuple[str, Union[torch.Tensor,np.ndarray]]]&quot;</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># type: ignore # noqa: F821</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>  <span class="c1"># type: ignore</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    <span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>    <span class="c1"># get shapes</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="n">data_shapes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">k</span><span class="p">:</span> <span class="n">shapes_convert</span><span class="p">(</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="n">tuple_dims_replace</span><span class="p">(</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>                <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="n">drop_batch_dims</span><span class="p">:],</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>                <span class="n">dims_names_map</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_items</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="p">}</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>    <span class="c1"># nest the dict</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>    <span class="n">data_nested</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">dotlist_to_nested_dict</span><span class="p">(</span><span class="n">data_shapes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>    <span class="c1"># condense the nested dict</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>    <span class="n">data_condensed</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">condense_nested_dicts</span><span class="p">(</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">data_nested</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">condense_numeric_keys</span><span class="o">=</span><span class="n">condense_numeric_keys</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="n">condense_matching_values</span><span class="o">=</span><span class="n">condense_matching_values</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">val_condense_fallback_mapping</span><span class="o">=</span><span class="n">val_condense_fallback_mapping</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>    <span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="c1"># return in the specified format</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>    <span class="n">fmt_lower</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>    <span class="k">if</span> <span class="n">fmt_lower</span> <span class="o">==</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="k">return</span> <span class="n">data_condensed</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>    <span class="k">elif</span> <span class="n">fmt_lower</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_condensed</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>    <span class="k">elif</span> <span class="n">fmt_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">]:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="kn">import</span> <span class="nn">yaml</span>  <span class="c1"># type: ignore[import-untyped]</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>            <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_condensed</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PyYAML is required for YAML output&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return format: </span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


                <br/>
            </section>
                <section id="DefaulterDict">
                            <input id="DefaulterDict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DefaulterDict</span><wbr>(<span class="base">typing.Dict[~_KT, ~_VT]</span>, <span class="base">typing.Generic[~_KT, ~_VT]</span>):

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="DefaulterDict-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L33-L50" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#DefaulterDict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DefaulterDict-34"><a href="#DefaulterDict-34"><span class="linenos">34</span></a><span class="k">class</span> <span class="nc">DefaulterDict</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">],</span> <span class="n">Generic</span><span class="p">[</span><span class="n">_KT</span><span class="p">,</span> <span class="n">_VT</span><span class="p">]):</span>
</span><span id="DefaulterDict-35"><a href="#DefaulterDict-35"><span class="linenos">35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;like a defaultdict, but default_factory is passed the key as an argument&quot;&quot;&quot;</span>
</span><span id="DefaulterDict-36"><a href="#DefaulterDict-36"><span class="linenos">36</span></a>
</span><span id="DefaulterDict-37"><a href="#DefaulterDict-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">_KT</span><span class="p">],</span> <span class="n">_VT</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="DefaulterDict-38"><a href="#DefaulterDict-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span><span id="DefaulterDict-39"><a href="#DefaulterDict-39"><span class="linenos">39</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="DefaulterDict-40"><a href="#DefaulterDict-40"><span class="linenos">40</span></a>                <span class="sa">f</span><span class="s2">&quot;DefaulterDict does not support positional arguments: *args = </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DefaulterDict-41"><a href="#DefaulterDict-41"><span class="linenos">41</span></a>            <span class="p">)</span>
</span><span id="DefaulterDict-42"><a href="#DefaulterDict-42"><span class="linenos">42</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="DefaulterDict-43"><a href="#DefaulterDict-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">_KT</span><span class="p">],</span> <span class="n">_VT</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_factory</span>
</span><span id="DefaulterDict-44"><a href="#DefaulterDict-44"><span class="linenos">44</span></a>
</span><span id="DefaulterDict-45"><a href="#DefaulterDict-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">_KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_VT</span><span class="p">:</span>
</span><span id="DefaulterDict-46"><a href="#DefaulterDict-46"><span class="linenos">46</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="DefaulterDict-47"><a href="#DefaulterDict-47"><span class="linenos">47</span></a>            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span><span id="DefaulterDict-48"><a href="#DefaulterDict-48"><span class="linenos">48</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DefaulterDict-49"><a href="#DefaulterDict-49"><span class="linenos">49</span></a>            <span class="n">v</span><span class="p">:</span> <span class="n">_VT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="DefaulterDict-50"><a href="#DefaulterDict-50"><span class="linenos">50</span></a>            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="DefaulterDict-51"><a href="#DefaulterDict-51"><span class="linenos">51</span></a>            <span class="k">return</span> <span class="n">v</span>
</span></pre></div>


            <div class="docstring"><p>like a defaultdict, but default_factory is passed the key as an argument</p>
</div>


                            <div id="DefaulterDict.default_factory" class="classattr">
                                <div class="attr variable">
            <span class="name">default_factory</span><span class="annotation">: Callable[[~_KT], ~_VT]</span>

        
    </div>
    <a class="headerlink" href="#DefaulterDict.default_factory"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="DefaulterDict.get" class="function">get</dd>
                <dd id="DefaulterDict.setdefault" class="function">setdefault</dd>
                <dd id="DefaulterDict.pop" class="function">pop</dd>
                <dd id="DefaulterDict.popitem" class="function">popitem</dd>
                <dd id="DefaulterDict.keys" class="function">keys</dd>
                <dd id="DefaulterDict.items" class="function">items</dd>
                <dd id="DefaulterDict.values" class="function">values</dd>
                <dd id="DefaulterDict.update" class="function">update</dd>
                <dd id="DefaulterDict.fromkeys" class="function">fromkeys</dd>
                <dd id="DefaulterDict.clear" class="function">clear</dd>
                <dd id="DefaulterDict.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="defaultdict_to_dict_recursive">
                            <input id="defaultdict_to_dict_recursive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">defaultdict_to_dict_recursive</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">,</span> <span class="n"><a href="#DefaulterDict">DefaulterDict</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="defaultdict_to_dict_recursive-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L57-L66" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#defaultdict_to_dict_recursive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="defaultdict_to_dict_recursive-58"><a href="#defaultdict_to_dict_recursive-58"><span class="linenos">58</span></a><span class="k">def</span> <span class="nf">defaultdict_to_dict_recursive</span><span class="p">(</span><span class="n">dd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">defaultdict</span><span class="p">,</span> <span class="n">DefaulterDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="defaultdict_to_dict_recursive-59"><a href="#defaultdict_to_dict_recursive-59"><span class="linenos">59</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a defaultdict or DefaulterDict to a normal dict, recursively&quot;&quot;&quot;</span>
</span><span id="defaultdict_to_dict_recursive-60"><a href="#defaultdict_to_dict_recursive-60"><span class="linenos">60</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="defaultdict_to_dict_recursive-61"><a href="#defaultdict_to_dict_recursive-61"><span class="linenos">61</span></a>        <span class="n">key</span><span class="p">:</span> <span class="p">(</span>
</span><span id="defaultdict_to_dict_recursive-62"><a href="#defaultdict_to_dict_recursive-62"><span class="linenos">62</span></a>            <span class="n">defaultdict_to_dict_recursive</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="defaultdict_to_dict_recursive-63"><a href="#defaultdict_to_dict_recursive-63"><span class="linenos">63</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">defaultdict</span><span class="p">,</span> <span class="n">DefaulterDict</span><span class="p">))</span>
</span><span id="defaultdict_to_dict_recursive-64"><a href="#defaultdict_to_dict_recursive-64"><span class="linenos">64</span></a>            <span class="k">else</span> <span class="n">value</span>
</span><span id="defaultdict_to_dict_recursive-65"><a href="#defaultdict_to_dict_recursive-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span><span id="defaultdict_to_dict_recursive-66"><a href="#defaultdict_to_dict_recursive-66"><span class="linenos">66</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="defaultdict_to_dict_recursive-67"><a href="#defaultdict_to_dict_recursive-67"><span class="linenos">67</span></a>    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Convert a defaultdict or DefaulterDict to a normal dict, recursively</p>
</div>


                </section>
                <section id="dotlist_to_nested_dict">
                            <input id="dotlist_to_nested_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dotlist_to_nested_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dot_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>, </span><span class="param"><span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="dotlist_to_nested_dict-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L69-L89" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#dotlist_to_nested_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dotlist_to_nested_dict-70"><a href="#dotlist_to_nested_dict-70"><span class="linenos">70</span></a><span class="k">def</span> <span class="nf">dotlist_to_nested_dict</span><span class="p">(</span>
</span><span id="dotlist_to_nested_dict-71"><a href="#dotlist_to_nested_dict-71"><span class="linenos">71</span></a>    <span class="n">dot_dict</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="dotlist_to_nested_dict-72"><a href="#dotlist_to_nested_dict-72"><span class="linenos">72</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="dotlist_to_nested_dict-73"><a href="#dotlist_to_nested_dict-73"><span class="linenos">73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a dict with dot-separated keys to a nested dict</span>
</span><span id="dotlist_to_nested_dict-74"><a href="#dotlist_to_nested_dict-74"><span class="linenos">74</span></a>
</span><span id="dotlist_to_nested_dict-75"><a href="#dotlist_to_nested_dict-75"><span class="linenos">75</span></a><span class="sd">    Example:</span>
</span><span id="dotlist_to_nested_dict-76"><a href="#dotlist_to_nested_dict-76"><span class="linenos">76</span></a>
</span><span id="dotlist_to_nested_dict-77"><a href="#dotlist_to_nested_dict-77"><span class="linenos">77</span></a><span class="sd">        &gt;&gt;&gt; dotlist_to_nested_dict({&#39;a.b.c&#39;: 1, &#39;a.b.d&#39;: 2, &#39;a.e&#39;: 3})</span>
</span><span id="dotlist_to_nested_dict-78"><a href="#dotlist_to_nested_dict-78"><span class="linenos">78</span></a><span class="sd">        {&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: 1, &#39;d&#39;: 2}, &#39;e&#39;: 3}}</span>
</span><span id="dotlist_to_nested_dict-79"><a href="#dotlist_to_nested_dict-79"><span class="linenos">79</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dotlist_to_nested_dict-80"><a href="#dotlist_to_nested_dict-80"><span class="linenos">80</span></a>    <span class="n">nested_dict</span><span class="p">:</span> <span class="n">defaultdict</span> <span class="o">=</span> <span class="n">_recursive_defaultdict_ctor</span><span class="p">()</span>
</span><span id="dotlist_to_nested_dict-81"><a href="#dotlist_to_nested_dict-81"><span class="linenos">81</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dot_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="dotlist_to_nested_dict-82"><a href="#dotlist_to_nested_dict-82"><span class="linenos">82</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="dotlist_to_nested_dict-83"><a href="#dotlist_to_nested_dict-83"><span class="linenos">83</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key must be a string, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="dotlist_to_nested_dict-84"><a href="#dotlist_to_nested_dict-84"><span class="linenos">84</span></a>        <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="dotlist_to_nested_dict-85"><a href="#dotlist_to_nested_dict-85"><span class="linenos">85</span></a>        <span class="n">current</span><span class="p">:</span> <span class="n">defaultdict</span> <span class="o">=</span> <span class="n">nested_dict</span>
</span><span id="dotlist_to_nested_dict-86"><a href="#dotlist_to_nested_dict-86"><span class="linenos">86</span></a>        <span class="c1"># iterate over the keys except the last one</span>
</span><span id="dotlist_to_nested_dict-87"><a href="#dotlist_to_nested_dict-87"><span class="linenos">87</span></a>        <span class="k">for</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="dotlist_to_nested_dict-88"><a href="#dotlist_to_nested_dict-88"><span class="linenos">88</span></a>            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="n">sub_key</span><span class="p">]</span>
</span><span id="dotlist_to_nested_dict-89"><a href="#dotlist_to_nested_dict-89"><span class="linenos">89</span></a>        <span class="n">current</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="dotlist_to_nested_dict-90"><a href="#dotlist_to_nested_dict-90"><span class="linenos">90</span></a>    <span class="k">return</span> <span class="n">defaultdict_to_dict_recursive</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a dict with dot-separated keys to a nested dict</p>

<p>Example:</p>

<pre><code>&gt;&gt;&gt; dotlist_to_nested_dict({'a.b.c': 1, 'a.b.d': 2, 'a.e': 3})
{'a': {'b': {'c': 1, 'd': 2}, 'e': 3}}
</code></pre>
</div>


                </section>
                <section id="nested_dict_to_dotlist">
                            <input id="nested_dict_to_dotlist-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nested_dict_to_dotlist</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">nested_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>,</span><span class="param">	<span class="n">allow_lists</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="nested_dict_to_dotlist-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L92-L122" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#nested_dict_to_dotlist"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="nested_dict_to_dotlist-93"><a href="#nested_dict_to_dotlist-93"><span class="linenos"> 93</span></a><span class="k">def</span> <span class="nf">nested_dict_to_dotlist</span><span class="p">(</span>
</span><span id="nested_dict_to_dotlist-94"><a href="#nested_dict_to_dotlist-94"><span class="linenos"> 94</span></a>    <span class="n">nested_dict</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="nested_dict_to_dotlist-95"><a href="#nested_dict_to_dotlist-95"><span class="linenos"> 95</span></a>    <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="nested_dict_to_dotlist-96"><a href="#nested_dict_to_dotlist-96"><span class="linenos"> 96</span></a>    <span class="n">allow_lists</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="nested_dict_to_dotlist-97"><a href="#nested_dict_to_dotlist-97"><span class="linenos"> 97</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="nested_dict_to_dotlist-98"><a href="#nested_dict_to_dotlist-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">_recurse</span><span class="p">(</span><span class="n">current</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="nested_dict_to_dotlist-99"><a href="#nested_dict_to_dotlist-99"><span class="linenos"> 99</span></a>        <span class="n">items</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="nested_dict_to_dotlist-100"><a href="#nested_dict_to_dotlist-100"><span class="linenos">100</span></a>
</span><span id="nested_dict_to_dotlist-101"><a href="#nested_dict_to_dotlist-101"><span class="linenos">101</span></a>        <span class="n">new_key</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="nested_dict_to_dotlist-102"><a href="#nested_dict_to_dotlist-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="nested_dict_to_dotlist-103"><a href="#nested_dict_to_dotlist-103"><span class="linenos">103</span></a>            <span class="c1"># dict case</span>
</span><span id="nested_dict_to_dotlist-104"><a href="#nested_dict_to_dotlist-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">current</span> <span class="ow">and</span> <span class="n">parent_key</span><span class="p">:</span>
</span><span id="nested_dict_to_dotlist-105"><a href="#nested_dict_to_dotlist-105"><span class="linenos">105</span></a>                <span class="n">items</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
</span><span id="nested_dict_to_dotlist-106"><a href="#nested_dict_to_dotlist-106"><span class="linenos">106</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="nested_dict_to_dotlist-107"><a href="#nested_dict_to_dotlist-107"><span class="linenos">107</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="nested_dict_to_dotlist-108"><a href="#nested_dict_to_dotlist-108"><span class="linenos">108</span></a>                    <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}{</span><span class="n">sep</span><span class="si">}{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">parent_key</span> <span class="k">else</span> <span class="n">k</span>
</span><span id="nested_dict_to_dotlist-109"><a href="#nested_dict_to_dotlist-109"><span class="linenos">109</span></a>                    <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_recurse</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">new_key</span><span class="p">))</span>
</span><span id="nested_dict_to_dotlist-110"><a href="#nested_dict_to_dotlist-110"><span class="linenos">110</span></a>
</span><span id="nested_dict_to_dotlist-111"><a href="#nested_dict_to_dotlist-111"><span class="linenos">111</span></a>        <span class="k">elif</span> <span class="n">allow_lists</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="nested_dict_to_dotlist-112"><a href="#nested_dict_to_dotlist-112"><span class="linenos">112</span></a>            <span class="c1"># list case</span>
</span><span id="nested_dict_to_dotlist-113"><a href="#nested_dict_to_dotlist-113"><span class="linenos">113</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current</span><span class="p">):</span>
</span><span id="nested_dict_to_dotlist-114"><a href="#nested_dict_to_dotlist-114"><span class="linenos">114</span></a>                <span class="n">new_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_key</span><span class="si">}{</span><span class="n">sep</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">parent_key</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="nested_dict_to_dotlist-115"><a href="#nested_dict_to_dotlist-115"><span class="linenos">115</span></a>                <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_recurse</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">new_key</span><span class="p">))</span>
</span><span id="nested_dict_to_dotlist-116"><a href="#nested_dict_to_dotlist-116"><span class="linenos">116</span></a>
</span><span id="nested_dict_to_dotlist-117"><a href="#nested_dict_to_dotlist-117"><span class="linenos">117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="nested_dict_to_dotlist-118"><a href="#nested_dict_to_dotlist-118"><span class="linenos">118</span></a>            <span class="c1"># anything else (write value)</span>
</span><span id="nested_dict_to_dotlist-119"><a href="#nested_dict_to_dotlist-119"><span class="linenos">119</span></a>            <span class="n">items</span><span class="p">[</span><span class="n">parent_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">current</span>
</span><span id="nested_dict_to_dotlist-120"><a href="#nested_dict_to_dotlist-120"><span class="linenos">120</span></a>
</span><span id="nested_dict_to_dotlist-121"><a href="#nested_dict_to_dotlist-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">items</span>
</span><span id="nested_dict_to_dotlist-122"><a href="#nested_dict_to_dotlist-122"><span class="linenos">122</span></a>
</span><span id="nested_dict_to_dotlist-123"><a href="#nested_dict_to_dotlist-123"><span class="linenos">123</span></a>    <span class="k">return</span> <span class="n">_recurse</span><span class="p">(</span><span class="n">nested_dict</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="update_with_nested_dict">
                            <input id="update_with_nested_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_with_nested_dict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">original</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">update</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="update_with_nested_dict-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L125-L154" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#update_with_nested_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="update_with_nested_dict-126"><a href="#update_with_nested_dict-126"><span class="linenos">126</span></a><span class="k">def</span> <span class="nf">update_with_nested_dict</span><span class="p">(</span>
</span><span id="update_with_nested_dict-127"><a href="#update_with_nested_dict-127"><span class="linenos">127</span></a>    <span class="n">original</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="update_with_nested_dict-128"><a href="#update_with_nested_dict-128"><span class="linenos">128</span></a>    <span class="n">update</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="update_with_nested_dict-129"><a href="#update_with_nested_dict-129"><span class="linenos">129</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="update_with_nested_dict-130"><a href="#update_with_nested_dict-130"><span class="linenos">130</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a dict with a nested dict</span>
</span><span id="update_with_nested_dict-131"><a href="#update_with_nested_dict-131"><span class="linenos">131</span></a>
</span><span id="update_with_nested_dict-132"><a href="#update_with_nested_dict-132"><span class="linenos">132</span></a><span class="sd">    Example:</span>
</span><span id="update_with_nested_dict-133"><a href="#update_with_nested_dict-133"><span class="linenos">133</span></a><span class="sd">    &gt;&gt;&gt; update_with_nested_dict({&#39;a&#39;: {&#39;b&#39;: 1}, &quot;c&quot;: -1}, {&#39;a&#39;: {&quot;b&quot;: 2}})</span>
</span><span id="update_with_nested_dict-134"><a href="#update_with_nested_dict-134"><span class="linenos">134</span></a><span class="sd">    {&#39;a&#39;: {&#39;b&#39;: 2}, &#39;c&#39;: -1}</span>
</span><span id="update_with_nested_dict-135"><a href="#update_with_nested_dict-135"><span class="linenos">135</span></a>
</span><span id="update_with_nested_dict-136"><a href="#update_with_nested_dict-136"><span class="linenos">136</span></a><span class="sd">    # Arguments</span>
</span><span id="update_with_nested_dict-137"><a href="#update_with_nested_dict-137"><span class="linenos">137</span></a><span class="sd">    - `original: dict[str, Any]`</span>
</span><span id="update_with_nested_dict-138"><a href="#update_with_nested_dict-138"><span class="linenos">138</span></a><span class="sd">        the dict to update (will be modified in-place)</span>
</span><span id="update_with_nested_dict-139"><a href="#update_with_nested_dict-139"><span class="linenos">139</span></a><span class="sd">    - `update: dict[str, Any]`</span>
</span><span id="update_with_nested_dict-140"><a href="#update_with_nested_dict-140"><span class="linenos">140</span></a><span class="sd">        the dict to update with</span>
</span><span id="update_with_nested_dict-141"><a href="#update_with_nested_dict-141"><span class="linenos">141</span></a>
</span><span id="update_with_nested_dict-142"><a href="#update_with_nested_dict-142"><span class="linenos">142</span></a><span class="sd">    # Returns</span>
</span><span id="update_with_nested_dict-143"><a href="#update_with_nested_dict-143"><span class="linenos">143</span></a><span class="sd">    - `dict`</span>
</span><span id="update_with_nested_dict-144"><a href="#update_with_nested_dict-144"><span class="linenos">144</span></a><span class="sd">        the updated dict</span>
</span><span id="update_with_nested_dict-145"><a href="#update_with_nested_dict-145"><span class="linenos">145</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="update_with_nested_dict-146"><a href="#update_with_nested_dict-146"><span class="linenos">146</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="update_with_nested_dict-147"><a href="#update_with_nested_dict-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">original</span><span class="p">:</span>
</span><span id="update_with_nested_dict-148"><a href="#update_with_nested_dict-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="update_with_nested_dict-149"><a href="#update_with_nested_dict-149"><span class="linenos">149</span></a>                <span class="n">update_with_nested_dict</span><span class="p">(</span><span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
</span><span id="update_with_nested_dict-150"><a href="#update_with_nested_dict-150"><span class="linenos">150</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="update_with_nested_dict-151"><a href="#update_with_nested_dict-151"><span class="linenos">151</span></a>                <span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="update_with_nested_dict-152"><a href="#update_with_nested_dict-152"><span class="linenos">152</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="update_with_nested_dict-153"><a href="#update_with_nested_dict-153"><span class="linenos">153</span></a>            <span class="n">original</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="update_with_nested_dict-154"><a href="#update_with_nested_dict-154"><span class="linenos">154</span></a>
</span><span id="update_with_nested_dict-155"><a href="#update_with_nested_dict-155"><span class="linenos">155</span></a>    <span class="k">return</span> <span class="n">original</span>
</span></pre></div>


            <div class="docstring"><p>Update a dict with a nested dict</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">update_with_nested_dict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}})</span>
<span class="go">{&#39;a&#39;: {&#39;b&#39;: 2}, &#39;c&#39;: -1}</span>
</code></pre>
</div>

<h1 id="arguments">Arguments</h1>

<ul>
<li><code>original: dict[str, Any]</code>
the dict to update (will be modified in-place)</li>
<li><code>update: dict[str, Any]</code>
the dict to update with</li>
</ul>

<h1 id="returns">Returns</h1>

<ul>
<li><code>dict</code>
the updated dict</li>
</ul>
</div>


                </section>
                <section id="kwargs_to_nested_dict">
                            <input id="kwargs_to_nested_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">kwargs_to_nested_dict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">kwargs_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>,</span><span class="param">	<span class="n">strip_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">when_unknown_prefix</span><span class="p">:</span> <span class="n"><a href="errormode.html#ErrorMode">muutils.errormode.ErrorMode</a></span> <span class="o">=</span> <span class="n">ErrorMode</span><span class="o">.</span><span class="n">Warn</span>,</span><span class="param">	<span class="n">transform_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="kwargs_to_nested_dict-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L157-L211" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#kwargs_to_nested_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="kwargs_to_nested_dict-158"><a href="#kwargs_to_nested_dict-158"><span class="linenos">158</span></a><span class="k">def</span> <span class="nf">kwargs_to_nested_dict</span><span class="p">(</span>
</span><span id="kwargs_to_nested_dict-159"><a href="#kwargs_to_nested_dict-159"><span class="linenos">159</span></a>    <span class="n">kwargs_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="kwargs_to_nested_dict-160"><a href="#kwargs_to_nested_dict-160"><span class="linenos">160</span></a>    <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="kwargs_to_nested_dict-161"><a href="#kwargs_to_nested_dict-161"><span class="linenos">161</span></a>    <span class="n">strip_prefix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="kwargs_to_nested_dict-162"><a href="#kwargs_to_nested_dict-162"><span class="linenos">162</span></a>    <span class="n">when_unknown_prefix</span><span class="p">:</span> <span class="n">ErrorMode</span> <span class="o">=</span> <span class="n">ErrorMode</span><span class="o">.</span><span class="n">WARN</span><span class="p">,</span>
</span><span id="kwargs_to_nested_dict-163"><a href="#kwargs_to_nested_dict-163"><span class="linenos">163</span></a>    <span class="n">transform_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="kwargs_to_nested_dict-164"><a href="#kwargs_to_nested_dict-164"><span class="linenos">164</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="kwargs_to_nested_dict-165"><a href="#kwargs_to_nested_dict-165"><span class="linenos">165</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;given kwargs from fire, convert them to a nested dict</span>
</span><span id="kwargs_to_nested_dict-166"><a href="#kwargs_to_nested_dict-166"><span class="linenos">166</span></a>
</span><span id="kwargs_to_nested_dict-167"><a href="#kwargs_to_nested_dict-167"><span class="linenos">167</span></a><span class="sd">    if strip_prefix is not None, then all keys must start with the prefix. by default,</span>
</span><span id="kwargs_to_nested_dict-168"><a href="#kwargs_to_nested_dict-168"><span class="linenos">168</span></a><span class="sd">    will warn if an unknown prefix is found, but can be set to raise an error or ignore it:</span>
</span><span id="kwargs_to_nested_dict-169"><a href="#kwargs_to_nested_dict-169"><span class="linenos">169</span></a><span class="sd">    `when_unknown_prefix: ErrorMode`</span>
</span><span id="kwargs_to_nested_dict-170"><a href="#kwargs_to_nested_dict-170"><span class="linenos">170</span></a>
</span><span id="kwargs_to_nested_dict-171"><a href="#kwargs_to_nested_dict-171"><span class="linenos">171</span></a><span class="sd">    Example:</span>
</span><span id="kwargs_to_nested_dict-172"><a href="#kwargs_to_nested_dict-172"><span class="linenos">172</span></a><span class="sd">    ```python</span>
</span><span id="kwargs_to_nested_dict-173"><a href="#kwargs_to_nested_dict-173"><span class="linenos">173</span></a><span class="sd">    def main(**kwargs):</span>
</span><span id="kwargs_to_nested_dict-174"><a href="#kwargs_to_nested_dict-174"><span class="linenos">174</span></a><span class="sd">        print(kwargs_to_nested_dict(kwargs))</span>
</span><span id="kwargs_to_nested_dict-175"><a href="#kwargs_to_nested_dict-175"><span class="linenos">175</span></a><span class="sd">    fire.Fire(main)</span>
</span><span id="kwargs_to_nested_dict-176"><a href="#kwargs_to_nested_dict-176"><span class="linenos">176</span></a><span class="sd">    ```</span>
</span><span id="kwargs_to_nested_dict-177"><a href="#kwargs_to_nested_dict-177"><span class="linenos">177</span></a><span class="sd">    running the above script will give:</span>
</span><span id="kwargs_to_nested_dict-178"><a href="#kwargs_to_nested_dict-178"><span class="linenos">178</span></a><span class="sd">    ```bash</span>
</span><span id="kwargs_to_nested_dict-179"><a href="#kwargs_to_nested_dict-179"><span class="linenos">179</span></a><span class="sd">    $ python test.py --a.b.c=1 --a.b.d=2 --a.e=3</span>
</span><span id="kwargs_to_nested_dict-180"><a href="#kwargs_to_nested_dict-180"><span class="linenos">180</span></a><span class="sd">    {&#39;a&#39;: {&#39;b&#39;: {&#39;c&#39;: 1, &#39;d&#39;: 2}, &#39;e&#39;: 3}}</span>
</span><span id="kwargs_to_nested_dict-181"><a href="#kwargs_to_nested_dict-181"><span class="linenos">181</span></a><span class="sd">    ```</span>
</span><span id="kwargs_to_nested_dict-182"><a href="#kwargs_to_nested_dict-182"><span class="linenos">182</span></a>
</span><span id="kwargs_to_nested_dict-183"><a href="#kwargs_to_nested_dict-183"><span class="linenos">183</span></a><span class="sd">    # Arguments</span>
</span><span id="kwargs_to_nested_dict-184"><a href="#kwargs_to_nested_dict-184"><span class="linenos">184</span></a><span class="sd">    - `kwargs_dict: dict[str, Any]`</span>
</span><span id="kwargs_to_nested_dict-185"><a href="#kwargs_to_nested_dict-185"><span class="linenos">185</span></a><span class="sd">        the kwargs dict to convert</span>
</span><span id="kwargs_to_nested_dict-186"><a href="#kwargs_to_nested_dict-186"><span class="linenos">186</span></a><span class="sd">    - `sep: str = &quot;.&quot;`</span>
</span><span id="kwargs_to_nested_dict-187"><a href="#kwargs_to_nested_dict-187"><span class="linenos">187</span></a><span class="sd">        the separator to use for nested keys</span>
</span><span id="kwargs_to_nested_dict-188"><a href="#kwargs_to_nested_dict-188"><span class="linenos">188</span></a><span class="sd">    - `strip_prefix: Optional[str] = None`</span>
</span><span id="kwargs_to_nested_dict-189"><a href="#kwargs_to_nested_dict-189"><span class="linenos">189</span></a><span class="sd">        if not None, then all keys must start with this prefix</span>
</span><span id="kwargs_to_nested_dict-190"><a href="#kwargs_to_nested_dict-190"><span class="linenos">190</span></a><span class="sd">    - `when_unknown_prefix: ErrorMode = ErrorMode.WARN`</span>
</span><span id="kwargs_to_nested_dict-191"><a href="#kwargs_to_nested_dict-191"><span class="linenos">191</span></a><span class="sd">        what to do when an unknown prefix is found</span>
</span><span id="kwargs_to_nested_dict-192"><a href="#kwargs_to_nested_dict-192"><span class="linenos">192</span></a><span class="sd">    - `transform_key: Callable[[str], str] | None = None`</span>
</span><span id="kwargs_to_nested_dict-193"><a href="#kwargs_to_nested_dict-193"><span class="linenos">193</span></a><span class="sd">        a function to apply to each key before adding it to the dict (applied after stripping the prefix)</span>
</span><span id="kwargs_to_nested_dict-194"><a href="#kwargs_to_nested_dict-194"><span class="linenos">194</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="kwargs_to_nested_dict-195"><a href="#kwargs_to_nested_dict-195"><span class="linenos">195</span></a>    <span class="n">when_unknown_prefix</span> <span class="o">=</span> <span class="n">ErrorMode</span><span class="o">.</span><span class="n">from_any</span><span class="p">(</span><span class="n">when_unknown_prefix</span><span class="p">)</span>
</span><span id="kwargs_to_nested_dict-196"><a href="#kwargs_to_nested_dict-196"><span class="linenos">196</span></a>    <span class="n">filtered_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="kwargs_to_nested_dict-197"><a href="#kwargs_to_nested_dict-197"><span class="linenos">197</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="kwargs_to_nested_dict-198"><a href="#kwargs_to_nested_dict-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="n">strip_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="kwargs_to_nested_dict-199"><a href="#kwargs_to_nested_dict-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">strip_prefix</span><span class="p">):</span>
</span><span id="kwargs_to_nested_dict-200"><a href="#kwargs_to_nested_dict-200"><span class="linenos">200</span></a>                <span class="n">when_unknown_prefix</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
</span><span id="kwargs_to_nested_dict-201"><a href="#kwargs_to_nested_dict-201"><span class="linenos">201</span></a>                    <span class="sa">f</span><span class="s2">&quot;key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; does not start with &#39;</span><span class="si">{</span><span class="n">strip_prefix</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span id="kwargs_to_nested_dict-202"><a href="#kwargs_to_nested_dict-202"><span class="linenos">202</span></a>                    <span class="n">except_cls</span><span class="o">=</span><span class="ne">ValueError</span><span class="p">,</span>
</span><span id="kwargs_to_nested_dict-203"><a href="#kwargs_to_nested_dict-203"><span class="linenos">203</span></a>                <span class="p">)</span>
</span><span id="kwargs_to_nested_dict-204"><a href="#kwargs_to_nested_dict-204"><span class="linenos">204</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="kwargs_to_nested_dict-205"><a href="#kwargs_to_nested_dict-205"><span class="linenos">205</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">strip_prefix</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="kwargs_to_nested_dict-206"><a href="#kwargs_to_nested_dict-206"><span class="linenos">206</span></a>
</span><span id="kwargs_to_nested_dict-207"><a href="#kwargs_to_nested_dict-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="n">transform_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="kwargs_to_nested_dict-208"><a href="#kwargs_to_nested_dict-208"><span class="linenos">208</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">transform_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="kwargs_to_nested_dict-209"><a href="#kwargs_to_nested_dict-209"><span class="linenos">209</span></a>
</span><span id="kwargs_to_nested_dict-210"><a href="#kwargs_to_nested_dict-210"><span class="linenos">210</span></a>        <span class="n">filtered_kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="kwargs_to_nested_dict-211"><a href="#kwargs_to_nested_dict-211"><span class="linenos">211</span></a>
</span><span id="kwargs_to_nested_dict-212"><a href="#kwargs_to_nested_dict-212"><span class="linenos">212</span></a>    <span class="k">return</span> <span class="n">dotlist_to_nested_dict</span><span class="p">(</span><span class="n">filtered_kwargs</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>given kwargs from fire, convert them to a nested dict</p>

<p>if strip_prefix is not None, then all keys must start with the prefix. by default,
will warn if an unknown prefix is found, but can be set to raise an error or ignore it:
<code>when_unknown_prefix: ErrorMode</code></p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">kwargs_to_nested_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
<span class="n">fire</span><span class="o">.</span><span class="n">Fire</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
</code></pre>
</div>

<p>running the above script will give:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>test.py<span class="w"> </span>--a.b.c<span class="o">=</span><span class="m">1</span><span class="w"> </span>--a.b.d<span class="o">=</span><span class="m">2</span><span class="w"> </span>--a.e<span class="o">=</span><span class="m">3</span>
<span class="o">{</span><span class="s1">&#39;a&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;b&#39;</span>:<span class="w"> </span><span class="o">{</span><span class="s1">&#39;c&#39;</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="s1">&#39;d&#39;</span>:<span class="w"> </span><span class="m">2</span><span class="o">}</span>,<span class="w"> </span><span class="s1">&#39;e&#39;</span>:<span class="w"> </span><span class="m">3</span><span class="o">}}</span>
</code></pre>
</div>

<h1 id="arguments">Arguments</h1>

<ul>
<li><code>kwargs_dict: dict[str, Any]</code>
the kwargs dict to convert</li>
<li><code>sep: str = "."</code>
the separator to use for nested keys</li>
<li><code>strip_prefix: Optional[str] = None</code>
if not None, then all keys must start with this prefix</li>
<li><code>when_unknown_prefix: ErrorMode = ErrorMode.WARN</code>
what to do when an unknown prefix is found</li>
<li><code>transform_key: Callable[[str], str] | None = None</code>
a function to apply to each key before adding it to the dict (applied after stripping the prefix)</li>
</ul>
</div>


                </section>
                <section id="is_numeric_consecutive">
                            <input id="is_numeric_consecutive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_numeric_consecutive</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="is_numeric_consecutive-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L214-L220" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#is_numeric_consecutive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_numeric_consecutive-215"><a href="#is_numeric_consecutive-215"><span class="linenos">215</span></a><span class="k">def</span> <span class="nf">is_numeric_consecutive</span><span class="p">(</span><span class="n">lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="is_numeric_consecutive-216"><a href="#is_numeric_consecutive-216"><span class="linenos">216</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the list of keys is numeric and consecutive.&quot;&quot;&quot;</span>
</span><span id="is_numeric_consecutive-217"><a href="#is_numeric_consecutive-217"><span class="linenos">217</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="is_numeric_consecutive-218"><a href="#is_numeric_consecutive-218"><span class="linenos">218</span></a>        <span class="n">numbers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">]</span>
</span><span id="is_numeric_consecutive-219"><a href="#is_numeric_consecutive-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="is_numeric_consecutive-220"><a href="#is_numeric_consecutive-220"><span class="linenos">220</span></a>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="is_numeric_consecutive-221"><a href="#is_numeric_consecutive-221"><span class="linenos">221</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check if the list of keys is numeric and consecutive.</p>
</div>


                </section>
                <section id="condense_nested_dicts_numeric_keys">
                            <input id="condense_nested_dicts_numeric_keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">condense_nested_dicts_numeric_keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="condense_nested_dicts_numeric_keys-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L223-L267" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#condense_nested_dicts_numeric_keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="condense_nested_dicts_numeric_keys-224"><a href="#condense_nested_dicts_numeric_keys-224"><span class="linenos">224</span></a><span class="k">def</span> <span class="nf">condense_nested_dicts_numeric_keys</span><span class="p">(</span>
</span><span id="condense_nested_dicts_numeric_keys-225"><a href="#condense_nested_dicts_numeric_keys-225"><span class="linenos">225</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="condense_nested_dicts_numeric_keys-226"><a href="#condense_nested_dicts_numeric_keys-226"><span class="linenos">226</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="condense_nested_dicts_numeric_keys-227"><a href="#condense_nested_dicts_numeric_keys-227"><span class="linenos">227</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;condense a nested dict, by condensing numeric keys with matching values to ranges</span>
</span><span id="condense_nested_dicts_numeric_keys-228"><a href="#condense_nested_dicts_numeric_keys-228"><span class="linenos">228</span></a>
</span><span id="condense_nested_dicts_numeric_keys-229"><a href="#condense_nested_dicts_numeric_keys-229"><span class="linenos">229</span></a><span class="sd">    # Examples:</span>
</span><span id="condense_nested_dicts_numeric_keys-230"><a href="#condense_nested_dicts_numeric_keys-230"><span class="linenos">230</span></a><span class="sd">    ```python</span>
</span><span id="condense_nested_dicts_numeric_keys-231"><a href="#condense_nested_dicts_numeric_keys-231"><span class="linenos">231</span></a><span class="sd">    &gt;&gt;&gt; condense_nested_dicts_numeric_keys({&#39;1&#39;: 1, &#39;2&#39;: 1, &#39;3&#39;: 1, &#39;4&#39;: 2, &#39;5&#39;: 2, &#39;6&#39;: 2})</span>
</span><span id="condense_nested_dicts_numeric_keys-232"><a href="#condense_nested_dicts_numeric_keys-232"><span class="linenos">232</span></a><span class="sd">    {&#39;[1-3]&#39;: 1, &#39;[4-6]&#39;: 2}</span>
</span><span id="condense_nested_dicts_numeric_keys-233"><a href="#condense_nested_dicts_numeric_keys-233"><span class="linenos">233</span></a><span class="sd">    &gt;&gt;&gt; condense_nested_dicts_numeric_keys({&#39;1&#39;: {&#39;1&#39;: &#39;a&#39;, &#39;2&#39;: &#39;a&#39;}, &#39;2&#39;: &#39;b&#39;})</span>
</span><span id="condense_nested_dicts_numeric_keys-234"><a href="#condense_nested_dicts_numeric_keys-234"><span class="linenos">234</span></a><span class="sd">    {&quot;1&quot;: {&quot;[1-2]&quot;: &quot;a&quot;}, &quot;2&quot;: &quot;b&quot;}</span>
</span><span id="condense_nested_dicts_numeric_keys-235"><a href="#condense_nested_dicts_numeric_keys-235"><span class="linenos">235</span></a><span class="sd">    ```</span>
</span><span id="condense_nested_dicts_numeric_keys-236"><a href="#condense_nested_dicts_numeric_keys-236"><span class="linenos">236</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="condense_nested_dicts_numeric_keys-237"><a href="#condense_nested_dicts_numeric_keys-237"><span class="linenos">237</span></a>
</span><span id="condense_nested_dicts_numeric_keys-238"><a href="#condense_nested_dicts_numeric_keys-238"><span class="linenos">238</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="condense_nested_dicts_numeric_keys-239"><a href="#condense_nested_dicts_numeric_keys-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="condense_nested_dicts_numeric_keys-240"><a href="#condense_nested_dicts_numeric_keys-240"><span class="linenos">240</span></a>
</span><span id="condense_nested_dicts_numeric_keys-241"><a href="#condense_nested_dicts_numeric_keys-241"><span class="linenos">241</span></a>    <span class="c1"># Process each sub-dictionary</span>
</span><span id="condense_nested_dicts_numeric_keys-242"><a href="#condense_nested_dicts_numeric_keys-242"><span class="linenos">242</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="condense_nested_dicts_numeric_keys-243"><a href="#condense_nested_dicts_numeric_keys-243"><span class="linenos">243</span></a>        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">condense_nested_dicts_numeric_keys</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="condense_nested_dicts_numeric_keys-244"><a href="#condense_nested_dicts_numeric_keys-244"><span class="linenos">244</span></a>
</span><span id="condense_nested_dicts_numeric_keys-245"><a href="#condense_nested_dicts_numeric_keys-245"><span class="linenos">245</span></a>    <span class="c1"># Find all numeric, consecutive keys</span>
</span><span id="condense_nested_dicts_numeric_keys-246"><a href="#condense_nested_dicts_numeric_keys-246"><span class="linenos">246</span></a>    <span class="k">if</span> <span class="n">is_numeric_consecutive</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="condense_nested_dicts_numeric_keys-247"><a href="#condense_nested_dicts_numeric_keys-247"><span class="linenos">247</span></a>        <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="condense_nested_dicts_numeric_keys-248"><a href="#condense_nested_dicts_numeric_keys-248"><span class="linenos">248</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="condense_nested_dicts_numeric_keys-249"><a href="#condense_nested_dicts_numeric_keys-249"><span class="linenos">249</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="condense_nested_dicts_numeric_keys-250"><a href="#condense_nested_dicts_numeric_keys-250"><span class="linenos">250</span></a>
</span><span id="condense_nested_dicts_numeric_keys-251"><a href="#condense_nested_dicts_numeric_keys-251"><span class="linenos">251</span></a>    <span class="c1"># output dict</span>
</span><span id="condense_nested_dicts_numeric_keys-252"><a href="#condense_nested_dicts_numeric_keys-252"><span class="linenos">252</span></a>    <span class="n">condensed_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="condense_nested_dicts_numeric_keys-253"><a href="#condense_nested_dicts_numeric_keys-253"><span class="linenos">253</span></a>
</span><span id="condense_nested_dicts_numeric_keys-254"><a href="#condense_nested_dicts_numeric_keys-254"><span class="linenos">254</span></a>    <span class="c1"># Identify ranges of identical values and condense</span>
</span><span id="condense_nested_dicts_numeric_keys-255"><a href="#condense_nested_dicts_numeric_keys-255"><span class="linenos">255</span></a>    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="condense_nested_dicts_numeric_keys-256"><a href="#condense_nested_dicts_numeric_keys-256"><span class="linenos">256</span></a>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
</span><span id="condense_nested_dicts_numeric_keys-257"><a href="#condense_nested_dicts_numeric_keys-257"><span class="linenos">257</span></a>        <span class="n">j</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="condense_nested_dicts_numeric_keys-258"><a href="#condense_nested_dicts_numeric_keys-258"><span class="linenos">258</span></a>        <span class="k">while</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]:</span>
</span><span id="condense_nested_dicts_numeric_keys-259"><a href="#condense_nested_dicts_numeric_keys-259"><span class="linenos">259</span></a>            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="condense_nested_dicts_numeric_keys-260"><a href="#condense_nested_dicts_numeric_keys-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># Found consecutive keys with identical values</span>
</span><span id="condense_nested_dicts_numeric_keys-261"><a href="#condense_nested_dicts_numeric_keys-261"><span class="linenos">261</span></a>            <span class="n">condensed_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span id="condense_nested_dicts_numeric_keys-262"><a href="#condense_nested_dicts_numeric_keys-262"><span class="linenos">262</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">condensed_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="condense_nested_dicts_numeric_keys-263"><a href="#condense_nested_dicts_numeric_keys-263"><span class="linenos">263</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="condense_nested_dicts_numeric_keys-264"><a href="#condense_nested_dicts_numeric_keys-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="condense_nested_dicts_numeric_keys-265"><a href="#condense_nested_dicts_numeric_keys-265"><span class="linenos">265</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="condense_nested_dicts_numeric_keys-266"><a href="#condense_nested_dicts_numeric_keys-266"><span class="linenos">266</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="condense_nested_dicts_numeric_keys-267"><a href="#condense_nested_dicts_numeric_keys-267"><span class="linenos">267</span></a>
</span><span id="condense_nested_dicts_numeric_keys-268"><a href="#condense_nested_dicts_numeric_keys-268"><span class="linenos">268</span></a>    <span class="k">return</span> <span class="n">condensed_data</span>
</span></pre></div>


            <div class="docstring"><p>condense a nested dict, by condensing numeric keys with matching values to ranges</p>

<h1 id="examples">Examples:</h1>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">condense_nested_dicts_numeric_keys</span><span class="p">({</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="p">{</span><span class="s1">&#39;[1-3]&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;[4-6]&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">condense_nested_dicts_numeric_keys</span><span class="p">({</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">},</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">})</span>
<span class="p">{</span><span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;[1-2]&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">},</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">}</span>
</code></pre>
</div>
</div>


                </section>
                <section id="condense_nested_dicts_matching_values">
                            <input id="condense_nested_dicts_matching_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">condense_nested_dicts_matching_values</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="condense_nested_dicts_matching_values-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L270-L321" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#condense_nested_dicts_matching_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="condense_nested_dicts_matching_values-271"><a href="#condense_nested_dicts_matching_values-271"><span class="linenos">271</span></a><span class="k">def</span> <span class="nf">condense_nested_dicts_matching_values</span><span class="p">(</span>
</span><span id="condense_nested_dicts_matching_values-272"><a href="#condense_nested_dicts_matching_values-272"><span class="linenos">272</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="condense_nested_dicts_matching_values-273"><a href="#condense_nested_dicts_matching_values-273"><span class="linenos">273</span></a>    <span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="condense_nested_dicts_matching_values-274"><a href="#condense_nested_dicts_matching_values-274"><span class="linenos">274</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="condense_nested_dicts_matching_values-275"><a href="#condense_nested_dicts_matching_values-275"><span class="linenos">275</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;condense a nested dict, by condensing keys with matching values</span>
</span><span id="condense_nested_dicts_matching_values-276"><a href="#condense_nested_dicts_matching_values-276"><span class="linenos">276</span></a>
</span><span id="condense_nested_dicts_matching_values-277"><a href="#condense_nested_dicts_matching_values-277"><span class="linenos">277</span></a><span class="sd">    # Examples: TODO</span>
</span><span id="condense_nested_dicts_matching_values-278"><a href="#condense_nested_dicts_matching_values-278"><span class="linenos">278</span></a>
</span><span id="condense_nested_dicts_matching_values-279"><a href="#condense_nested_dicts_matching_values-279"><span class="linenos">279</span></a><span class="sd">    # Parameters:</span>
</span><span id="condense_nested_dicts_matching_values-280"><a href="#condense_nested_dicts_matching_values-280"><span class="linenos">280</span></a><span class="sd">     - `data : dict[str, Any]`</span>
</span><span id="condense_nested_dicts_matching_values-281"><a href="#condense_nested_dicts_matching_values-281"><span class="linenos">281</span></a><span class="sd">        data to process</span>
</span><span id="condense_nested_dicts_matching_values-282"><a href="#condense_nested_dicts_matching_values-282"><span class="linenos">282</span></a><span class="sd">     - `val_condense_fallback_mapping : Callable[[Any], Hashable] | None`</span>
</span><span id="condense_nested_dicts_matching_values-283"><a href="#condense_nested_dicts_matching_values-283"><span class="linenos">283</span></a><span class="sd">        a function to apply to each value before adding it to the dict (if it&#39;s not hashable)</span>
</span><span id="condense_nested_dicts_matching_values-284"><a href="#condense_nested_dicts_matching_values-284"><span class="linenos">284</span></a><span class="sd">        (defaults to `None`)</span>
</span><span id="condense_nested_dicts_matching_values-285"><a href="#condense_nested_dicts_matching_values-285"><span class="linenos">285</span></a>
</span><span id="condense_nested_dicts_matching_values-286"><a href="#condense_nested_dicts_matching_values-286"><span class="linenos">286</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="condense_nested_dicts_matching_values-287"><a href="#condense_nested_dicts_matching_values-287"><span class="linenos">287</span></a>
</span><span id="condense_nested_dicts_matching_values-288"><a href="#condense_nested_dicts_matching_values-288"><span class="linenos">288</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="condense_nested_dicts_matching_values-289"><a href="#condense_nested_dicts_matching_values-289"><span class="linenos">289</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="condense_nested_dicts_matching_values-290"><a href="#condense_nested_dicts_matching_values-290"><span class="linenos">290</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">condense_nested_dicts_matching_values</span><span class="p">(</span>
</span><span id="condense_nested_dicts_matching_values-291"><a href="#condense_nested_dicts_matching_values-291"><span class="linenos">291</span></a>                <span class="n">value</span><span class="p">,</span> <span class="n">val_condense_fallback_mapping</span>
</span><span id="condense_nested_dicts_matching_values-292"><a href="#condense_nested_dicts_matching_values-292"><span class="linenos">292</span></a>            <span class="p">)</span>
</span><span id="condense_nested_dicts_matching_values-293"><a href="#condense_nested_dicts_matching_values-293"><span class="linenos">293</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="condense_nested_dicts_matching_values-294"><a href="#condense_nested_dicts_matching_values-294"><span class="linenos">294</span></a>        <span class="p">}</span>
</span><span id="condense_nested_dicts_matching_values-295"><a href="#condense_nested_dicts_matching_values-295"><span class="linenos">295</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-296"><a href="#condense_nested_dicts_matching_values-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="condense_nested_dicts_matching_values-297"><a href="#condense_nested_dicts_matching_values-297"><span class="linenos">297</span></a>
</span><span id="condense_nested_dicts_matching_values-298"><a href="#condense_nested_dicts_matching_values-298"><span class="linenos">298</span></a>    <span class="c1"># Find all identical values and condense by stitching together keys</span>
</span><span id="condense_nested_dicts_matching_values-299"><a href="#condense_nested_dicts_matching_values-299"><span class="linenos">299</span></a>    <span class="n">values_grouped</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="condense_nested_dicts_matching_values-300"><a href="#condense_nested_dicts_matching_values-300"><span class="linenos">300</span></a>    <span class="n">data_persist</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="condense_nested_dicts_matching_values-301"><a href="#condense_nested_dicts_matching_values-301"><span class="linenos">301</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="condense_nested_dicts_matching_values-302"><a href="#condense_nested_dicts_matching_values-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="condense_nested_dicts_matching_values-303"><a href="#condense_nested_dicts_matching_values-303"><span class="linenos">303</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-304"><a href="#condense_nested_dicts_matching_values-304"><span class="linenos">304</span></a>                <span class="n">values_grouped</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="condense_nested_dicts_matching_values-305"><a href="#condense_nested_dicts_matching_values-305"><span class="linenos">305</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-306"><a href="#condense_nested_dicts_matching_values-306"><span class="linenos">306</span></a>                <span class="c1"># If the value is unhashable, use a fallback mapping to find a hashable representation</span>
</span><span id="condense_nested_dicts_matching_values-307"><a href="#condense_nested_dicts_matching_values-307"><span class="linenos">307</span></a>                <span class="k">if</span> <span class="n">val_condense_fallback_mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-308"><a href="#condense_nested_dicts_matching_values-308"><span class="linenos">308</span></a>                    <span class="n">values_grouped</span><span class="p">[</span><span class="n">val_condense_fallback_mapping</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="condense_nested_dicts_matching_values-309"><a href="#condense_nested_dicts_matching_values-309"><span class="linenos">309</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-310"><a href="#condense_nested_dicts_matching_values-310"><span class="linenos">310</span></a>                    <span class="n">data_persist</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="condense_nested_dicts_matching_values-311"><a href="#condense_nested_dicts_matching_values-311"><span class="linenos">311</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-312"><a href="#condense_nested_dicts_matching_values-312"><span class="linenos">312</span></a>            <span class="n">data_persist</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="condense_nested_dicts_matching_values-313"><a href="#condense_nested_dicts_matching_values-313"><span class="linenos">313</span></a>
</span><span id="condense_nested_dicts_matching_values-314"><a href="#condense_nested_dicts_matching_values-314"><span class="linenos">314</span></a>    <span class="n">condensed_data</span> <span class="o">=</span> <span class="n">data_persist</span>
</span><span id="condense_nested_dicts_matching_values-315"><a href="#condense_nested_dicts_matching_values-315"><span class="linenos">315</span></a>    <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">values_grouped</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="condense_nested_dicts_matching_values-316"><a href="#condense_nested_dicts_matching_values-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-317"><a href="#condense_nested_dicts_matching_values-317"><span class="linenos">317</span></a>            <span class="n">merged_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span>  <span class="c1"># Choose an appropriate method to represent merged keys</span>
</span><span id="condense_nested_dicts_matching_values-318"><a href="#condense_nested_dicts_matching_values-318"><span class="linenos">318</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">merged_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="condense_nested_dicts_matching_values-319"><a href="#condense_nested_dicts_matching_values-319"><span class="linenos">319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="condense_nested_dicts_matching_values-320"><a href="#condense_nested_dicts_matching_values-320"><span class="linenos">320</span></a>            <span class="n">condensed_data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="condense_nested_dicts_matching_values-321"><a href="#condense_nested_dicts_matching_values-321"><span class="linenos">321</span></a>
</span><span id="condense_nested_dicts_matching_values-322"><a href="#condense_nested_dicts_matching_values-322"><span class="linenos">322</span></a>    <span class="k">return</span> <span class="n">condensed_data</span>
</span></pre></div>


            <div class="docstring"><p>condense a nested dict, by condensing keys with matching values</p>

<h1 id="examples-todo">Examples: TODO</h1>

<h1 id="parameters">Parameters:</h1>

<ul>
<li><code>data : dict[str, Any]</code>
data to process</li>
<li><code>val_condense_fallback_mapping : Callable[[Any], Hashable] | None</code>
a function to apply to each value before adding it to the dict (if it's not hashable)
(defaults to <code>None</code>)</li>
</ul>
</div>


                </section>
                <section id="condense_nested_dicts">
                            <input id="condense_nested_dicts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">condense_nested_dicts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">condense_numeric_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">condense_matching_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="condense_nested_dicts-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L324-L359" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#condense_nested_dicts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="condense_nested_dicts-325"><a href="#condense_nested_dicts-325"><span class="linenos">325</span></a><span class="k">def</span> <span class="nf">condense_nested_dicts</span><span class="p">(</span>
</span><span id="condense_nested_dicts-326"><a href="#condense_nested_dicts-326"><span class="linenos">326</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="condense_nested_dicts-327"><a href="#condense_nested_dicts-327"><span class="linenos">327</span></a>    <span class="n">condense_numeric_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="condense_nested_dicts-328"><a href="#condense_nested_dicts-328"><span class="linenos">328</span></a>    <span class="n">condense_matching_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="condense_nested_dicts-329"><a href="#condense_nested_dicts-329"><span class="linenos">329</span></a>    <span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="condense_nested_dicts-330"><a href="#condense_nested_dicts-330"><span class="linenos">330</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="condense_nested_dicts-331"><a href="#condense_nested_dicts-331"><span class="linenos">331</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;condense a nested dict, by condensing numeric or matching keys with matching values to ranges</span>
</span><span id="condense_nested_dicts-332"><a href="#condense_nested_dicts-332"><span class="linenos">332</span></a>
</span><span id="condense_nested_dicts-333"><a href="#condense_nested_dicts-333"><span class="linenos">333</span></a><span class="sd">    combines the functionality of `condense_nested_dicts_numeric_keys()` and `condense_nested_dicts_matching_values()`</span>
</span><span id="condense_nested_dicts-334"><a href="#condense_nested_dicts-334"><span class="linenos">334</span></a>
</span><span id="condense_nested_dicts-335"><a href="#condense_nested_dicts-335"><span class="linenos">335</span></a><span class="sd">    # NOTE: this process is not meant to be reversible, and is intended for pretty-printing and visualization purposes</span>
</span><span id="condense_nested_dicts-336"><a href="#condense_nested_dicts-336"><span class="linenos">336</span></a><span class="sd">    it&#39;s not reversible because types are lost to make the printing pretty</span>
</span><span id="condense_nested_dicts-337"><a href="#condense_nested_dicts-337"><span class="linenos">337</span></a>
</span><span id="condense_nested_dicts-338"><a href="#condense_nested_dicts-338"><span class="linenos">338</span></a><span class="sd">    # Parameters:</span>
</span><span id="condense_nested_dicts-339"><a href="#condense_nested_dicts-339"><span class="linenos">339</span></a><span class="sd">     - `data : dict[str, Any]`</span>
</span><span id="condense_nested_dicts-340"><a href="#condense_nested_dicts-340"><span class="linenos">340</span></a><span class="sd">        data to process</span>
</span><span id="condense_nested_dicts-341"><a href="#condense_nested_dicts-341"><span class="linenos">341</span></a><span class="sd">     - `condense_numeric_keys : bool`</span>
</span><span id="condense_nested_dicts-342"><a href="#condense_nested_dicts-342"><span class="linenos">342</span></a><span class="sd">        whether to condense numeric keys (e.g. &quot;1&quot;, &quot;2&quot;, &quot;3&quot;) to ranges (e.g. &quot;[1-3]&quot;)</span>
</span><span id="condense_nested_dicts-343"><a href="#condense_nested_dicts-343"><span class="linenos">343</span></a><span class="sd">       (defaults to `True`)</span>
</span><span id="condense_nested_dicts-344"><a href="#condense_nested_dicts-344"><span class="linenos">344</span></a><span class="sd">     - `condense_matching_values : bool`</span>
</span><span id="condense_nested_dicts-345"><a href="#condense_nested_dicts-345"><span class="linenos">345</span></a><span class="sd">        whether to condense keys with matching values</span>
</span><span id="condense_nested_dicts-346"><a href="#condense_nested_dicts-346"><span class="linenos">346</span></a><span class="sd">       (defaults to `True`)</span>
</span><span id="condense_nested_dicts-347"><a href="#condense_nested_dicts-347"><span class="linenos">347</span></a><span class="sd">     - `val_condense_fallback_mapping : Callable[[Any], Hashable] | None`</span>
</span><span id="condense_nested_dicts-348"><a href="#condense_nested_dicts-348"><span class="linenos">348</span></a><span class="sd">        a function to apply to each value before adding it to the dict (if it&#39;s not hashable)</span>
</span><span id="condense_nested_dicts-349"><a href="#condense_nested_dicts-349"><span class="linenos">349</span></a><span class="sd">       (defaults to `None`)</span>
</span><span id="condense_nested_dicts-350"><a href="#condense_nested_dicts-350"><span class="linenos">350</span></a>
</span><span id="condense_nested_dicts-351"><a href="#condense_nested_dicts-351"><span class="linenos">351</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="condense_nested_dicts-352"><a href="#condense_nested_dicts-352"><span class="linenos">352</span></a>
</span><span id="condense_nested_dicts-353"><a href="#condense_nested_dicts-353"><span class="linenos">353</span></a>    <span class="n">condensed_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="condense_nested_dicts-354"><a href="#condense_nested_dicts-354"><span class="linenos">354</span></a>    <span class="k">if</span> <span class="n">condense_numeric_keys</span><span class="p">:</span>
</span><span id="condense_nested_dicts-355"><a href="#condense_nested_dicts-355"><span class="linenos">355</span></a>        <span class="n">condensed_data</span> <span class="o">=</span> <span class="n">condense_nested_dicts_numeric_keys</span><span class="p">(</span><span class="n">condensed_data</span><span class="p">)</span>
</span><span id="condense_nested_dicts-356"><a href="#condense_nested_dicts-356"><span class="linenos">356</span></a>    <span class="k">if</span> <span class="n">condense_matching_values</span><span class="p">:</span>
</span><span id="condense_nested_dicts-357"><a href="#condense_nested_dicts-357"><span class="linenos">357</span></a>        <span class="n">condensed_data</span> <span class="o">=</span> <span class="n">condense_nested_dicts_matching_values</span><span class="p">(</span>
</span><span id="condense_nested_dicts-358"><a href="#condense_nested_dicts-358"><span class="linenos">358</span></a>            <span class="n">condensed_data</span><span class="p">,</span> <span class="n">val_condense_fallback_mapping</span>
</span><span id="condense_nested_dicts-359"><a href="#condense_nested_dicts-359"><span class="linenos">359</span></a>        <span class="p">)</span>
</span><span id="condense_nested_dicts-360"><a href="#condense_nested_dicts-360"><span class="linenos">360</span></a>    <span class="k">return</span> <span class="n">condensed_data</span>
</span></pre></div>


            <div class="docstring"><p>condense a nested dict, by condensing numeric or matching keys with matching values to ranges</p>

<p>combines the functionality of <code><a href="#condense_nested_dicts_numeric_keys">condense_nested_dicts_numeric_keys()</a></code> and <code><a href="#condense_nested_dicts_matching_values">condense_nested_dicts_matching_values()</a></code></p>

<h1 id="note-this-process-is-not-meant-to-be-reversible-and-is-intended-for-pretty-printing-and-visualization-purposes">NOTE: this process is not meant to be reversible, and is intended for pretty-printing and visualization purposes</h1>

<p>it's not reversible because types are lost to make the printing pretty</p>

<h1 id="parameters">Parameters:</h1>

<ul>
<li><code>data : dict[str, Any]</code>
data to process</li>
<li><code>condense_numeric_keys : bool</code>
 whether to condense numeric keys (e.g. "1", "2", "3") to ranges (e.g. "[1-3]")
(defaults to <code>True</code>)</li>
<li><code>condense_matching_values : bool</code>
 whether to condense keys with matching values
(defaults to <code>True</code>)</li>
<li><code>val_condense_fallback_mapping : Callable[[Any], Hashable] | None</code>
 a function to apply to each value before adding it to the dict (if it's not hashable)
(defaults to <code>None</code>)</li>
</ul>
</div>


                </section>
                <section id="tuple_dims_replace">
                            <input id="tuple_dims_replace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tuple_dims_replace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">t</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>,</span><span class="param">	<span class="n">dims_names_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="tuple_dims_replace-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L362-L368" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#tuple_dims_replace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tuple_dims_replace-363"><a href="#tuple_dims_replace-363"><span class="linenos">363</span></a><span class="k">def</span> <span class="nf">tuple_dims_replace</span><span class="p">(</span>
</span><span id="tuple_dims_replace-364"><a href="#tuple_dims_replace-364"><span class="linenos">364</span></a>    <span class="n">t</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dims_names_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="tuple_dims_replace-365"><a href="#tuple_dims_replace-365"><span class="linenos">365</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="tuple_dims_replace-366"><a href="#tuple_dims_replace-366"><span class="linenos">366</span></a>    <span class="k">if</span> <span class="n">dims_names_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tuple_dims_replace-367"><a href="#tuple_dims_replace-367"><span class="linenos">367</span></a>        <span class="k">return</span> <span class="n">t</span>
</span><span id="tuple_dims_replace-368"><a href="#tuple_dims_replace-368"><span class="linenos">368</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="tuple_dims_replace-369"><a href="#tuple_dims_replace-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dims_names_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">t</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="TensorDict">
                    <div class="attr variable">
            <span class="name">TensorDict</span>        =
<span class="default_value">typing.Dict[str, ForwardRef(&#39;torch.Tensor|np.ndarray&#39;)]</span>

        
    </div>
    <a class="headerlink" href="#TensorDict"></a>
    
    

                </section>
                <section id="TensorIterable">
                    <div class="attr variable">
            <span class="name">TensorIterable</span>        =
<span class="default_value">typing.Iterable[typing.Tuple[str, ForwardRef(&#39;torch.Tensor|np.ndarray&#39;)]]</span>

        
    </div>
    <a class="headerlink" href="#TensorIterable"></a>
    
    

                </section>
                <section id="TensorDictFormats">
                    <div class="attr variable">
            <span class="name">TensorDictFormats</span>        =
<span class="default_value">typing.Literal[&#39;dict&#39;, &#39;json&#39;, &#39;yaml&#39;, &#39;yml&#39;]</span>

        
    </div>
    <a class="headerlink" href="#TensorDictFormats"></a>
    
    

                </section>
                <section id="condense_tensor_dict">
                            <input id="condense_tensor_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">condense_tensor_dict</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="s1">&#39;TensorDict | TensorIterable&#39;</span>,</span><span class="param">	<span class="n">fmt</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;yml&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dict&#39;</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="n">shapes_convert</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">tuple</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">_default_shapes_convert</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">drop_batch_dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>,</span><span class="param">	<span class="n">dims_names_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">condense_numeric_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">condense_matching_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">return_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;yml&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <div class="source-button-container">
            <label class="pdoc-button view-source-button" for="condense_tensor_dict-view-source"><span>View Source</span></label>
            <div class="github-button-wrapper">
                <a class="pdoc-button github-link-button" href="https://github.com/mivanit/muutils/blob/0.8.1/dictmagic.py#L380-L522" target="_blank">
                    <span>View on GitHub</span>
                </a>
            </div>
        </div>

    </div>
    <a class="headerlink" href="#condense_tensor_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="condense_tensor_dict-381"><a href="#condense_tensor_dict-381"><span class="linenos">381</span></a><span class="k">def</span> <span class="nf">condense_tensor_dict</span><span class="p">(</span>
</span><span id="condense_tensor_dict-382"><a href="#condense_tensor_dict-382"><span class="linenos">382</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">TensorDict</span> <span class="o">|</span> <span class="n">TensorIterable</span><span class="p">,</span>
</span><span id="condense_tensor_dict-383"><a href="#condense_tensor_dict-383"><span class="linenos">383</span></a>    <span class="n">fmt</span><span class="p">:</span> <span class="n">TensorDictFormats</span> <span class="o">=</span> <span class="s2">&quot;dict&quot;</span><span class="p">,</span>
</span><span id="condense_tensor_dict-384"><a href="#condense_tensor_dict-384"><span class="linenos">384</span></a>    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="condense_tensor_dict-385"><a href="#condense_tensor_dict-385"><span class="linenos">385</span></a>    <span class="n">shapes_convert</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">tuple</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">_default_shapes_convert</span><span class="p">,</span>
</span><span id="condense_tensor_dict-386"><a href="#condense_tensor_dict-386"><span class="linenos">386</span></a>    <span class="n">drop_batch_dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="condense_tensor_dict-387"><a href="#condense_tensor_dict-387"><span class="linenos">387</span></a>    <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span id="condense_tensor_dict-388"><a href="#condense_tensor_dict-388"><span class="linenos">388</span></a>    <span class="n">dims_names_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="condense_tensor_dict-389"><a href="#condense_tensor_dict-389"><span class="linenos">389</span></a>    <span class="n">condense_numeric_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="condense_tensor_dict-390"><a href="#condense_tensor_dict-390"><span class="linenos">390</span></a>    <span class="n">condense_matching_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="condense_tensor_dict-391"><a href="#condense_tensor_dict-391"><span class="linenos">391</span></a>    <span class="n">val_condense_fallback_mapping</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="condense_tensor_dict-392"><a href="#condense_tensor_dict-392"><span class="linenos">392</span></a>    <span class="n">return_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TensorDictFormats</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="condense_tensor_dict-393"><a href="#condense_tensor_dict-393"><span class="linenos">393</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
</span><span id="condense_tensor_dict-394"><a href="#condense_tensor_dict-394"><span class="linenos">394</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a dictionary of tensors to a dictionary of shapes.</span>
</span><span id="condense_tensor_dict-395"><a href="#condense_tensor_dict-395"><span class="linenos">395</span></a>
</span><span id="condense_tensor_dict-396"><a href="#condense_tensor_dict-396"><span class="linenos">396</span></a><span class="sd">    by default, values are converted to strings of their shapes (for nice printing).</span>
</span><span id="condense_tensor_dict-397"><a href="#condense_tensor_dict-397"><span class="linenos">397</span></a><span class="sd">    If you want the actual shapes, set `shapes_convert = lambda x: x` or `shapes_convert = None`.</span>
</span><span id="condense_tensor_dict-398"><a href="#condense_tensor_dict-398"><span class="linenos">398</span></a>
</span><span id="condense_tensor_dict-399"><a href="#condense_tensor_dict-399"><span class="linenos">399</span></a><span class="sd">    # Parameters:</span>
</span><span id="condense_tensor_dict-400"><a href="#condense_tensor_dict-400"><span class="linenos">400</span></a><span class="sd">     - `data : dict[str, &quot;torch.Tensor|np.ndarray&quot;] | Iterable[tuple[str, &quot;torch.Tensor|np.ndarray&quot;]]`</span>
</span><span id="condense_tensor_dict-401"><a href="#condense_tensor_dict-401"><span class="linenos">401</span></a><span class="sd">        a either a `TensorDict` dict from strings to tensors, or an `TensorIterable` iterable of (key, tensor) pairs (like you might get from a `dict().items())` )</span>
</span><span id="condense_tensor_dict-402"><a href="#condense_tensor_dict-402"><span class="linenos">402</span></a><span class="sd">     - `fmt : TensorDictFormats`</span>
</span><span id="condense_tensor_dict-403"><a href="#condense_tensor_dict-403"><span class="linenos">403</span></a><span class="sd">        format to return the result in -- either a dict, or dump to json/yaml directly for pretty printing. will crash if yaml is not installed.</span>
</span><span id="condense_tensor_dict-404"><a href="#condense_tensor_dict-404"><span class="linenos">404</span></a><span class="sd">        (defaults to `&#39;dict&#39;`)</span>
</span><span id="condense_tensor_dict-405"><a href="#condense_tensor_dict-405"><span class="linenos">405</span></a><span class="sd">     - `shapes_convert : Callable[[tuple], Any]`</span>
</span><span id="condense_tensor_dict-406"><a href="#condense_tensor_dict-406"><span class="linenos">406</span></a><span class="sd">        conversion of a shape tuple to a string or other format (defaults to turning it into a string and removing quotes)</span>
</span><span id="condense_tensor_dict-407"><a href="#condense_tensor_dict-407"><span class="linenos">407</span></a><span class="sd">        (defaults to `lambdax:str(x).replace(&#39;&quot;&#39;, &#39;&#39;).replace(&quot;&#39;&quot;, &#39;&#39;)`)</span>
</span><span id="condense_tensor_dict-408"><a href="#condense_tensor_dict-408"><span class="linenos">408</span></a><span class="sd">     - `drop_batch_dims : int`</span>
</span><span id="condense_tensor_dict-409"><a href="#condense_tensor_dict-409"><span class="linenos">409</span></a><span class="sd">        number of leading dimensions to drop from the shape</span>
</span><span id="condense_tensor_dict-410"><a href="#condense_tensor_dict-410"><span class="linenos">410</span></a><span class="sd">        (defaults to `0`)</span>
</span><span id="condense_tensor_dict-411"><a href="#condense_tensor_dict-411"><span class="linenos">411</span></a><span class="sd">     - `sep : str`</span>
</span><span id="condense_tensor_dict-412"><a href="#condense_tensor_dict-412"><span class="linenos">412</span></a><span class="sd">        separator to use for nested keys</span>
</span><span id="condense_tensor_dict-413"><a href="#condense_tensor_dict-413"><span class="linenos">413</span></a><span class="sd">        (defaults to `&#39;.&#39;`)</span>
</span><span id="condense_tensor_dict-414"><a href="#condense_tensor_dict-414"><span class="linenos">414</span></a><span class="sd">     - `dims_names_map : dict[int, str] | None`</span>
</span><span id="condense_tensor_dict-415"><a href="#condense_tensor_dict-415"><span class="linenos">415</span></a><span class="sd">        convert certain dimension values in shape. not perfect, can be buggy</span>
</span><span id="condense_tensor_dict-416"><a href="#condense_tensor_dict-416"><span class="linenos">416</span></a><span class="sd">        (defaults to `None`)</span>
</span><span id="condense_tensor_dict-417"><a href="#condense_tensor_dict-417"><span class="linenos">417</span></a><span class="sd">     - `condense_numeric_keys : bool`</span>
</span><span id="condense_tensor_dict-418"><a href="#condense_tensor_dict-418"><span class="linenos">418</span></a><span class="sd">        whether to condense numeric keys (e.g. &quot;1&quot;, &quot;2&quot;, &quot;3&quot;) to ranges (e.g. &quot;[1-3]&quot;), passed on to `condense_nested_dicts`</span>
</span><span id="condense_tensor_dict-419"><a href="#condense_tensor_dict-419"><span class="linenos">419</span></a><span class="sd">        (defaults to `True`)</span>
</span><span id="condense_tensor_dict-420"><a href="#condense_tensor_dict-420"><span class="linenos">420</span></a><span class="sd">     - `condense_matching_values : bool`</span>
</span><span id="condense_tensor_dict-421"><a href="#condense_tensor_dict-421"><span class="linenos">421</span></a><span class="sd">        whether to condense keys with matching values, passed on to `condense_nested_dicts`</span>
</span><span id="condense_tensor_dict-422"><a href="#condense_tensor_dict-422"><span class="linenos">422</span></a><span class="sd">        (defaults to `True`)</span>
</span><span id="condense_tensor_dict-423"><a href="#condense_tensor_dict-423"><span class="linenos">423</span></a><span class="sd">     - `val_condense_fallback_mapping : Callable[[Any], Hashable] | None`</span>
</span><span id="condense_tensor_dict-424"><a href="#condense_tensor_dict-424"><span class="linenos">424</span></a><span class="sd">        a function to apply to each value before adding it to the dict (if it&#39;s not hashable), passed on to `condense_nested_dicts`</span>
</span><span id="condense_tensor_dict-425"><a href="#condense_tensor_dict-425"><span class="linenos">425</span></a><span class="sd">        (defaults to `None`)</span>
</span><span id="condense_tensor_dict-426"><a href="#condense_tensor_dict-426"><span class="linenos">426</span></a><span class="sd">     - `return_format : TensorDictFormats | None`</span>
</span><span id="condense_tensor_dict-427"><a href="#condense_tensor_dict-427"><span class="linenos">427</span></a><span class="sd">        legacy alias for `fmt` kwarg</span>
</span><span id="condense_tensor_dict-428"><a href="#condense_tensor_dict-428"><span class="linenos">428</span></a>
</span><span id="condense_tensor_dict-429"><a href="#condense_tensor_dict-429"><span class="linenos">429</span></a><span class="sd">    # Returns:</span>
</span><span id="condense_tensor_dict-430"><a href="#condense_tensor_dict-430"><span class="linenos">430</span></a><span class="sd">     - `str|dict[str, str|tuple[int, ...]]`</span>
</span><span id="condense_tensor_dict-431"><a href="#condense_tensor_dict-431"><span class="linenos">431</span></a><span class="sd">        dict if `return_format=&#39;dict&#39;`, a string for `json` or `yaml` output</span>
</span><span id="condense_tensor_dict-432"><a href="#condense_tensor_dict-432"><span class="linenos">432</span></a>
</span><span id="condense_tensor_dict-433"><a href="#condense_tensor_dict-433"><span class="linenos">433</span></a><span class="sd">    # Examples:</span>
</span><span id="condense_tensor_dict-434"><a href="#condense_tensor_dict-434"><span class="linenos">434</span></a><span class="sd">    ```python</span>
</span><span id="condense_tensor_dict-435"><a href="#condense_tensor_dict-435"><span class="linenos">435</span></a><span class="sd">    &gt;&gt;&gt; model = transformer_lens.HookedTransformer.from_pretrained(&quot;gpt2&quot;)</span>
</span><span id="condense_tensor_dict-436"><a href="#condense_tensor_dict-436"><span class="linenos">436</span></a><span class="sd">    &gt;&gt;&gt; print(condense_tensor_dict(model.named_parameters(), return_format=&#39;yaml&#39;))</span>
</span><span id="condense_tensor_dict-437"><a href="#condense_tensor_dict-437"><span class="linenos">437</span></a><span class="sd">    ```</span>
</span><span id="condense_tensor_dict-438"><a href="#condense_tensor_dict-438"><span class="linenos">438</span></a><span class="sd">    ```yaml</span>
</span><span id="condense_tensor_dict-439"><a href="#condense_tensor_dict-439"><span class="linenos">439</span></a><span class="sd">    embed:</span>
</span><span id="condense_tensor_dict-440"><a href="#condense_tensor_dict-440"><span class="linenos">440</span></a><span class="sd">      W_E: (50257, 768)</span>
</span><span id="condense_tensor_dict-441"><a href="#condense_tensor_dict-441"><span class="linenos">441</span></a><span class="sd">    pos_embed:</span>
</span><span id="condense_tensor_dict-442"><a href="#condense_tensor_dict-442"><span class="linenos">442</span></a><span class="sd">      W_pos: (1024, 768)</span>
</span><span id="condense_tensor_dict-443"><a href="#condense_tensor_dict-443"><span class="linenos">443</span></a><span class="sd">    blocks:</span>
</span><span id="condense_tensor_dict-444"><a href="#condense_tensor_dict-444"><span class="linenos">444</span></a><span class="sd">      &#39;[0-11]&#39;:</span>
</span><span id="condense_tensor_dict-445"><a href="#condense_tensor_dict-445"><span class="linenos">445</span></a><span class="sd">        attn:</span>
</span><span id="condense_tensor_dict-446"><a href="#condense_tensor_dict-446"><span class="linenos">446</span></a><span class="sd">          &#39;[W_Q, W_K, W_V]&#39;: (12, 768, 64)</span>
</span><span id="condense_tensor_dict-447"><a href="#condense_tensor_dict-447"><span class="linenos">447</span></a><span class="sd">          W_O: (12, 64, 768)</span>
</span><span id="condense_tensor_dict-448"><a href="#condense_tensor_dict-448"><span class="linenos">448</span></a><span class="sd">          &#39;[b_Q, b_K, b_V]&#39;: (12, 64)</span>
</span><span id="condense_tensor_dict-449"><a href="#condense_tensor_dict-449"><span class="linenos">449</span></a><span class="sd">          b_O: (768,)</span>
</span><span id="condense_tensor_dict-450"><a href="#condense_tensor_dict-450"><span class="linenos">450</span></a><span class="sd">        mlp:</span>
</span><span id="condense_tensor_dict-451"><a href="#condense_tensor_dict-451"><span class="linenos">451</span></a><span class="sd">          W_in: (768, 3072)</span>
</span><span id="condense_tensor_dict-452"><a href="#condense_tensor_dict-452"><span class="linenos">452</span></a><span class="sd">          b_in: (3072,)</span>
</span><span id="condense_tensor_dict-453"><a href="#condense_tensor_dict-453"><span class="linenos">453</span></a><span class="sd">          W_out: (3072, 768)</span>
</span><span id="condense_tensor_dict-454"><a href="#condense_tensor_dict-454"><span class="linenos">454</span></a><span class="sd">          b_out: (768,)</span>
</span><span id="condense_tensor_dict-455"><a href="#condense_tensor_dict-455"><span class="linenos">455</span></a><span class="sd">    unembed:</span>
</span><span id="condense_tensor_dict-456"><a href="#condense_tensor_dict-456"><span class="linenos">456</span></a><span class="sd">      W_U: (768, 50257)</span>
</span><span id="condense_tensor_dict-457"><a href="#condense_tensor_dict-457"><span class="linenos">457</span></a><span class="sd">      b_U: (50257,)</span>
</span><span id="condense_tensor_dict-458"><a href="#condense_tensor_dict-458"><span class="linenos">458</span></a><span class="sd">    ```</span>
</span><span id="condense_tensor_dict-459"><a href="#condense_tensor_dict-459"><span class="linenos">459</span></a>
</span><span id="condense_tensor_dict-460"><a href="#condense_tensor_dict-460"><span class="linenos">460</span></a><span class="sd">    # Raises:</span>
</span><span id="condense_tensor_dict-461"><a href="#condense_tensor_dict-461"><span class="linenos">461</span></a><span class="sd">     - `ValueError` :  if `return_format` is not one of &#39;dict&#39;, &#39;json&#39;, or &#39;yaml&#39;, or if you try to use &#39;yaml&#39; output without having PyYAML installed</span>
</span><span id="condense_tensor_dict-462"><a href="#condense_tensor_dict-462"><span class="linenos">462</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="condense_tensor_dict-463"><a href="#condense_tensor_dict-463"><span class="linenos">463</span></a>
</span><span id="condense_tensor_dict-464"><a href="#condense_tensor_dict-464"><span class="linenos">464</span></a>    <span class="c1"># handle arg processing:</span>
</span><span id="condense_tensor_dict-465"><a href="#condense_tensor_dict-465"><span class="linenos">465</span></a>    <span class="c1"># ----------------------------------------------------------------------</span>
</span><span id="condense_tensor_dict-466"><a href="#condense_tensor_dict-466"><span class="linenos">466</span></a>    <span class="c1"># make all args except data and format keyword-only</span>
</span><span id="condense_tensor_dict-467"><a href="#condense_tensor_dict-467"><span class="linenos">467</span></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;unexpected positional args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="condense_tensor_dict-468"><a href="#condense_tensor_dict-468"><span class="linenos">468</span></a>    <span class="c1"># handle legacy return_format</span>
</span><span id="condense_tensor_dict-469"><a href="#condense_tensor_dict-469"><span class="linenos">469</span></a>    <span class="k">if</span> <span class="n">return_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="condense_tensor_dict-470"><a href="#condense_tensor_dict-470"><span class="linenos">470</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="condense_tensor_dict-471"><a href="#condense_tensor_dict-471"><span class="linenos">471</span></a>            <span class="s2">&quot;return_format is deprecated, use fmt instead&quot;</span><span class="p">,</span>
</span><span id="condense_tensor_dict-472"><a href="#condense_tensor_dict-472"><span class="linenos">472</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="condense_tensor_dict-473"><a href="#condense_tensor_dict-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="condense_tensor_dict-474"><a href="#condense_tensor_dict-474"><span class="linenos">474</span></a>        <span class="n">fmt</span> <span class="o">=</span> <span class="n">return_format</span>
</span><span id="condense_tensor_dict-475"><a href="#condense_tensor_dict-475"><span class="linenos">475</span></a>
</span><span id="condense_tensor_dict-476"><a href="#condense_tensor_dict-476"><span class="linenos">476</span></a>    <span class="c1"># identity function for shapes_convert if not provided</span>
</span><span id="condense_tensor_dict-477"><a href="#condense_tensor_dict-477"><span class="linenos">477</span></a>    <span class="k">if</span> <span class="n">shapes_convert</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="condense_tensor_dict-478"><a href="#condense_tensor_dict-478"><span class="linenos">478</span></a>        <span class="n">shapes_convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>  <span class="c1"># noqa: E731</span>
</span><span id="condense_tensor_dict-479"><a href="#condense_tensor_dict-479"><span class="linenos">479</span></a>
</span><span id="condense_tensor_dict-480"><a href="#condense_tensor_dict-480"><span class="linenos">480</span></a>    <span class="c1"># convert to iterable</span>
</span><span id="condense_tensor_dict-481"><a href="#condense_tensor_dict-481"><span class="linenos">481</span></a>    <span class="n">data_items</span><span class="p">:</span> <span class="s2">&quot;Iterable[tuple[str, Union[torch.Tensor,np.ndarray]]]&quot;</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># type: ignore # noqa: F821</span>
</span><span id="condense_tensor_dict-482"><a href="#condense_tensor_dict-482"><span class="linenos">482</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>  <span class="c1"># type: ignore</span>
</span><span id="condense_tensor_dict-483"><a href="#condense_tensor_dict-483"><span class="linenos">483</span></a>    <span class="p">)</span>
</span><span id="condense_tensor_dict-484"><a href="#condense_tensor_dict-484"><span class="linenos">484</span></a>
</span><span id="condense_tensor_dict-485"><a href="#condense_tensor_dict-485"><span class="linenos">485</span></a>    <span class="c1"># get shapes</span>
</span><span id="condense_tensor_dict-486"><a href="#condense_tensor_dict-486"><span class="linenos">486</span></a>    <span class="n">data_shapes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="condense_tensor_dict-487"><a href="#condense_tensor_dict-487"><span class="linenos">487</span></a>        <span class="n">k</span><span class="p">:</span> <span class="n">shapes_convert</span><span class="p">(</span>
</span><span id="condense_tensor_dict-488"><a href="#condense_tensor_dict-488"><span class="linenos">488</span></a>            <span class="n">tuple_dims_replace</span><span class="p">(</span>
</span><span id="condense_tensor_dict-489"><a href="#condense_tensor_dict-489"><span class="linenos">489</span></a>                <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="n">drop_batch_dims</span><span class="p">:],</span>
</span><span id="condense_tensor_dict-490"><a href="#condense_tensor_dict-490"><span class="linenos">490</span></a>                <span class="n">dims_names_map</span><span class="p">,</span>
</span><span id="condense_tensor_dict-491"><a href="#condense_tensor_dict-491"><span class="linenos">491</span></a>            <span class="p">)</span>
</span><span id="condense_tensor_dict-492"><a href="#condense_tensor_dict-492"><span class="linenos">492</span></a>        <span class="p">)</span>
</span><span id="condense_tensor_dict-493"><a href="#condense_tensor_dict-493"><span class="linenos">493</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_items</span>
</span><span id="condense_tensor_dict-494"><a href="#condense_tensor_dict-494"><span class="linenos">494</span></a>    <span class="p">}</span>
</span><span id="condense_tensor_dict-495"><a href="#condense_tensor_dict-495"><span class="linenos">495</span></a>
</span><span id="condense_tensor_dict-496"><a href="#condense_tensor_dict-496"><span class="linenos">496</span></a>    <span class="c1"># nest the dict</span>
</span><span id="condense_tensor_dict-497"><a href="#condense_tensor_dict-497"><span class="linenos">497</span></a>    <span class="n">data_nested</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">dotlist_to_nested_dict</span><span class="p">(</span><span class="n">data_shapes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
</span><span id="condense_tensor_dict-498"><a href="#condense_tensor_dict-498"><span class="linenos">498</span></a>
</span><span id="condense_tensor_dict-499"><a href="#condense_tensor_dict-499"><span class="linenos">499</span></a>    <span class="c1"># condense the nested dict</span>
</span><span id="condense_tensor_dict-500"><a href="#condense_tensor_dict-500"><span class="linenos">500</span></a>    <span class="n">data_condensed</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">condense_nested_dicts</span><span class="p">(</span>
</span><span id="condense_tensor_dict-501"><a href="#condense_tensor_dict-501"><span class="linenos">501</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">data_nested</span><span class="p">,</span>
</span><span id="condense_tensor_dict-502"><a href="#condense_tensor_dict-502"><span class="linenos">502</span></a>        <span class="n">condense_numeric_keys</span><span class="o">=</span><span class="n">condense_numeric_keys</span><span class="p">,</span>
</span><span id="condense_tensor_dict-503"><a href="#condense_tensor_dict-503"><span class="linenos">503</span></a>        <span class="n">condense_matching_values</span><span class="o">=</span><span class="n">condense_matching_values</span><span class="p">,</span>
</span><span id="condense_tensor_dict-504"><a href="#condense_tensor_dict-504"><span class="linenos">504</span></a>        <span class="n">val_condense_fallback_mapping</span><span class="o">=</span><span class="n">val_condense_fallback_mapping</span><span class="p">,</span>
</span><span id="condense_tensor_dict-505"><a href="#condense_tensor_dict-505"><span class="linenos">505</span></a>    <span class="p">)</span>
</span><span id="condense_tensor_dict-506"><a href="#condense_tensor_dict-506"><span class="linenos">506</span></a>
</span><span id="condense_tensor_dict-507"><a href="#condense_tensor_dict-507"><span class="linenos">507</span></a>    <span class="c1"># return in the specified format</span>
</span><span id="condense_tensor_dict-508"><a href="#condense_tensor_dict-508"><span class="linenos">508</span></a>    <span class="n">fmt_lower</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="condense_tensor_dict-509"><a href="#condense_tensor_dict-509"><span class="linenos">509</span></a>    <span class="k">if</span> <span class="n">fmt_lower</span> <span class="o">==</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span>
</span><span id="condense_tensor_dict-510"><a href="#condense_tensor_dict-510"><span class="linenos">510</span></a>        <span class="k">return</span> <span class="n">data_condensed</span>
</span><span id="condense_tensor_dict-511"><a href="#condense_tensor_dict-511"><span class="linenos">511</span></a>    <span class="k">elif</span> <span class="n">fmt_lower</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
</span><span id="condense_tensor_dict-512"><a href="#condense_tensor_dict-512"><span class="linenos">512</span></a>        <span class="kn">import</span> <span class="nn">json</span>
</span><span id="condense_tensor_dict-513"><a href="#condense_tensor_dict-513"><span class="linenos">513</span></a>
</span><span id="condense_tensor_dict-514"><a href="#condense_tensor_dict-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_condensed</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="condense_tensor_dict-515"><a href="#condense_tensor_dict-515"><span class="linenos">515</span></a>    <span class="k">elif</span> <span class="n">fmt_lower</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;yml&quot;</span><span class="p">]:</span>
</span><span id="condense_tensor_dict-516"><a href="#condense_tensor_dict-516"><span class="linenos">516</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="condense_tensor_dict-517"><a href="#condense_tensor_dict-517"><span class="linenos">517</span></a>            <span class="kn">import</span> <span class="nn">yaml</span>  <span class="c1"># type: ignore[import-untyped]</span>
</span><span id="condense_tensor_dict-518"><a href="#condense_tensor_dict-518"><span class="linenos">518</span></a>
</span><span id="condense_tensor_dict-519"><a href="#condense_tensor_dict-519"><span class="linenos">519</span></a>            <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_condensed</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="condense_tensor_dict-520"><a href="#condense_tensor_dict-520"><span class="linenos">520</span></a>        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="condense_tensor_dict-521"><a href="#condense_tensor_dict-521"><span class="linenos">521</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PyYAML is required for YAML output&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
</span><span id="condense_tensor_dict-522"><a href="#condense_tensor_dict-522"><span class="linenos">522</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="condense_tensor_dict-523"><a href="#condense_tensor_dict-523"><span class="linenos">523</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return format: </span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a dictionary of tensors to a dictionary of shapes.</p>

<p>by default, values are converted to strings of their shapes (for nice printing).
If you want the actual shapes, set <code>shapes_convert = lambda x: x</code> or <code>shapes_convert = None</code>.</p>

<h1 id="parameters">Parameters:</h1>

<ul>
<li><code>data : dict[str, "torch.Tensor|np.ndarray"] | Iterable[tuple[str, "torch.Tensor|np.ndarray"]]</code>
a either a <code><a href="#TensorDict">TensorDict</a></code> dict from strings to tensors, or an <code><a href="#TensorIterable">TensorIterable</a></code> iterable of (key, tensor) pairs (like you might get from a <code>dict().items())</code> )</li>
<li><code>fmt : TensorDictFormats</code>
format to return the result in -- either a dict, or dump to json/yaml directly for pretty printing. will crash if yaml is not installed.
(defaults to <code>'dict'</code>)</li>
<li><code>shapes_convert : Callable[[tuple], Any]</code>
conversion of a shape tuple to a string or other format (defaults to turning it into a string and removing quotes)
(defaults to <code>lambdax:str(x).replace('"', '').replace("'", '')</code>)</li>
<li><code>drop_batch_dims : int</code>
number of leading dimensions to drop from the shape
(defaults to <code>0</code>)</li>
<li><code>sep : str</code>
separator to use for nested keys
(defaults to <code>'.'</code>)</li>
<li><code>dims_names_map : dict[int, str] | None</code>
convert certain dimension values in shape. not perfect, can be buggy
(defaults to <code>None</code>)</li>
<li><code>condense_numeric_keys : bool</code>
whether to condense numeric keys (e.g. "1", "2", "3") to ranges (e.g. "[1-3]"), passed on to <code><a href="#condense_nested_dicts">condense_nested_dicts</a></code>
(defaults to <code>True</code>)</li>
<li><code>condense_matching_values : bool</code>
whether to condense keys with matching values, passed on to <code><a href="#condense_nested_dicts">condense_nested_dicts</a></code>
(defaults to <code>True</code>)</li>
<li><code>val_condense_fallback_mapping : Callable[[Any], Hashable] | None</code>
a function to apply to each value before adding it to the dict (if it's not hashable), passed on to <code><a href="#condense_nested_dicts">condense_nested_dicts</a></code>
(defaults to <code>None</code>)</li>
<li><code>return_format : TensorDictFormats | None</code>
legacy alias for <code>fmt</code> kwarg</li>
</ul>

<h1 id="returns">Returns:</h1>

<ul>
<li><code>str|dict[str, str|tuple[int, ...]]</code>
dict if <code>return_format='dict'</code>, a string for <code>json</code> or <code>yaml</code> output</li>
</ul>

<h1 id="examples">Examples:</h1>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">transformer_lens</span><span class="o">.</span><span class="n">HookedTransformer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;gpt2&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">condense_tensor_dict</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">(),</span> <span class="n">return_format</span><span class="o">=</span><span class="s1">&#39;yaml&#39;</span><span class="p">))</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nt">embed</span><span class="p">:</span>
<span class="w">  </span><span class="nt">W_E</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(50257, 768)</span>
<span class="nt">pos_embed</span><span class="p">:</span>
<span class="w">  </span><span class="nt">W_pos</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(1024, 768)</span>
<span class="nt">blocks</span><span class="p">:</span>
<span class="w">  </span><span class="s">&#39;[0-11]&#39;</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">attn</span><span class="p">:</span>
<span class="w">      </span><span class="s">&#39;[W_Q,</span><span class="nv"> </span><span class="s">W_K,</span><span class="nv"> </span><span class="s">W_V]&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(12, 768, 64)</span>
<span class="w">      </span><span class="nt">W_O</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(12, 64, 768)</span>
<span class="w">      </span><span class="s">&#39;[b_Q,</span><span class="nv"> </span><span class="s">b_K,</span><span class="nv"> </span><span class="s">b_V]&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(12, 64)</span>
<span class="w">      </span><span class="nt">b_O</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(768,)</span>
<span class="w">    </span><span class="nt">mlp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">W_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(768, 3072)</span>
<span class="w">      </span><span class="nt">b_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(3072,)</span>
<span class="w">      </span><span class="nt">W_out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(3072, 768)</span>
<span class="w">      </span><span class="nt">b_out</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(768,)</span>
<span class="nt">unembed</span><span class="p">:</span>
<span class="w">  </span><span class="nt">W_U</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(768, 50257)</span>
<span class="w">  </span><span class="nt">b_U</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(50257,)</span>
</code></pre>
</div>

<h1 id="raises">Raises:</h1>

<ul>
<li><code>ValueError</code> :  if <code>return_format</code> is not one of 'dict', 'json', or 'yaml', or if you try to use 'yaml' output without having PyYAML installed</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>